<!doctype html>
<html lang="en" data-theme="steel-night">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design System Studio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./theme.css">
  <style>
    .studio{display:grid;grid-template-columns:300px 1fr;min-height:100vh;background:var(--ds-bg)}
    .studio-sidebar{position:sticky;top:0;height:100vh;overflow:auto;border-right:var(--ds-border-w) var(--ds-border-style) var(--ds-border);background:var(--ds-bg-elevated);padding:var(--ds-space-4);display:grid;gap:var(--ds-space-4);align-content:start}
    .studio-brand h1{margin:0;font-size:var(--ds-fs-3)}
    .studio-brand p{margin:4px 0 0;color:var(--ds-text-muted);font-size:var(--ds-fs-1)}
    .studio-nav{display:grid;gap:var(--ds-space-2)}
    .studio-divider{margin:0;border:0;border-top:var(--ds-border-w) var(--ds-border-style) var(--ds-border)}
    .studio-tab{width:100%;text-align:left}
    .studio-tab[aria-selected="true"]{border-color:var(--ds-accent);background:color-mix(in oklab,var(--ds-accent) 16%,var(--ds-btn-bg));color:var(--ds-text)}
    .studio-main{min-width:0;padding:var(--ds-space-5)}
    .studio-panel{justify-items:stretch}
    .studio-panel[hidden]{display:none}
    .preset-grid{display:grid;gap:var(--ds-space-2)}
    .builder-grid{display:grid;gap:var(--ds-space-4);grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .builder-group{display:grid;gap:var(--ds-space-3);align-content:start}
    .builder-field{display:grid;gap:10px;padding-block-end:6px}
    .builder-field label{font-size:var(--ds-fs-1);color:var(--ds-text-muted);text-transform:uppercase;letter-spacing:.06em}
    .builder-field-head{display:grid;grid-template-columns:minmax(0,1fr) auto;gap:6px;align-items:center}
    .builder-field-actions{display:inline-flex;gap:4px;opacity:0;pointer-events:none;transition:opacity .15s ease}
    .builder-field:hover .builder-field-actions,.builder-field:focus-within .builder-field-actions{opacity:1;pointer-events:auto}
    .builder-help-btn{min-width:24px;min-height:24px;padding:0 6px;font-size:11px;line-height:1}
    .builder-field-row{display:grid;grid-template-columns:1fr 88px;gap:var(--ds-space-2);align-items:center}
    .builder-field-row.single{grid-template-columns:1fr}
    .builder-color{width:100%;min-height:var(--ds-control-h);border:var(--ds-border-w) var(--ds-border-style) var(--ds-input-border);background:var(--ds-color-input-bg);border-radius:var(--ds-color-input-radius);box-shadow:var(--ds-color-input-shadow);padding:var(--ds-color-input-pad)}
    .builder-output{min-height:220px;width:100%;font-family:var(--ds-font-mono);font-size:var(--ds-fs-1)}
    .guide-grid{display:grid;gap:var(--ds-layout-gap);grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .mono{font-family:var(--ds-font-mono)}
    .control-grid{display:grid;gap:var(--ds-space-3);grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .control-box{border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-2);padding:var(--ds-space-3);background:var(--ds-bg-raised);display:grid;gap:var(--ds-space-2);align-content:start}
    .pill-row{display:flex;flex-wrap:wrap;gap:var(--ds-space-2);align-items:flex-start}
    .pill-row>*{flex:0 0 auto}
    .pill{border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-pill);background:var(--ds-bg-soft);color:var(--ds-text);padding:6px 12px;font-size:var(--ds-fs-1)}
    .seg{display:inline-flex;border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-2);overflow:hidden}
    .seg button{border:0;border-right:var(--ds-border-w) var(--ds-border-style) var(--ds-border);background:var(--ds-bg-raised);color:var(--ds-text-muted);padding:8px 12px;cursor:pointer}
    .seg button:last-child{border-right:0}
    .seg button[aria-pressed="true"]{background:color-mix(in oklab,var(--ds-accent) 16%,var(--ds-bg-raised));color:var(--ds-text)}
    .arrow-control{display:inline-flex;gap:var(--ds-space-2);align-items:center}
    .arrow-value{min-width:50px;text-align:center;font-family:var(--ds-font-mono)}
    .scroll-demo{max-height:160px;overflow:auto;border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-2);background:var(--ds-bg-raised);padding:var(--ds-space-3);display:grid;gap:var(--ds-space-2)}
    .scroll-demo::-webkit-scrollbar{width:var(--ds-scrollbar-size-y);height:var(--ds-scrollbar-size-x)}
    .scroll-demo::-webkit-scrollbar-thumb{border-radius:var(--ds-scrollbar-radius);background:var(--ds-scrollbar-thumb);border:2px solid transparent;background-clip:content-box}
    .scroll-demo::-webkit-scrollbar-track{background:var(--ds-scrollbar-track)}
    .builder-shadow-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:6px}
    .builder-shadow-grid.compact{grid-template-columns:1fr 1fr}
    .builder-shadow-flag{display:flex;align-items:center;gap:6px;font-size:var(--ds-fs-1);color:var(--ds-text-muted)}
    .builder-multi-grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:6px}
    .builder-multi-grid.compact{grid-template-columns:1fr 1fr}
    .builder-preset-row{display:flex;flex-wrap:wrap;gap:6px}
    .builder-preset-row .ds-btn{min-height:26px;padding:0 8px;font-size:var(--ds-fs-1)}
    .calendar-grid{display:grid;grid-template-columns:repeat(7,minmax(0,1fr));gap:6px}
    .calendar-grid span{display:grid;place-items:center;min-height:30px;border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-1);font-size:var(--ds-fs-1);background:var(--ds-bg-soft)}
    .calendar-grid .head{background:transparent;border-color:transparent;color:var(--ds-text-muted);text-transform:uppercase;letter-spacing:.05em}
    .calendar-grid .today{border-color:var(--ds-accent);background:color-mix(in oklab,var(--ds-accent) 22%,var(--ds-bg-soft));color:var(--ds-text)}
    .calendar-grid .muted{opacity:.55}
    .viz-grid{display:grid;gap:var(--ds-space-3);grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .viz-panel{border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-2);background:var(--ds-bg-raised);padding:var(--ds-space-3)}
    .viz-svg{width:100%;height:170px;display:block}
    .viz-axis{stroke:var(--ds-border-strong);stroke-width:1}
    .viz-gridline{stroke:color-mix(in oklab,var(--ds-border) 65%, transparent);stroke-width:1}
    .viz-line{fill:none;stroke:var(--ds-accent);stroke-width:3}
    .viz-area{fill:color-mix(in oklab,var(--ds-accent) 24%, transparent)}
    .viz-bar{fill:color-mix(in oklab,var(--ds-accent) 70%, var(--ds-bg-raised))}
    .viz-bar.alt{fill:color-mix(in oklab,var(--ds-info) 72%, var(--ds-bg-raised))}
    .viz-ring-bg{stroke:var(--ds-border);stroke-width:16;fill:none}
    .viz-ring-main{stroke:var(--ds-accent);stroke-width:16;fill:none;stroke-linecap:round}
    .viz-ring-sub{stroke:var(--ds-info);stroke-width:16;fill:none;stroke-linecap:round}
    .viz-flow-node{fill:var(--ds-bg-elevated);stroke:var(--ds-border-strong);stroke-width:1.5}
    .viz-flow-link{stroke:var(--ds-accent);stroke-width:2;fill:none}
    .token-table code{white-space:nowrap}
    .studio-main .ds-card{align-content:start;align-items:stretch}
    .studio-main .studio-panel > .ds-card{width:100%;max-width:none;justify-self:stretch}
    .token-info-grid{display:grid;gap:var(--ds-space-2)}
    .token-info-grid code{display:block;white-space:pre-wrap;word-break:break-word}
    @media (max-width:980px){.studio{grid-template-columns:1fr}.studio-sidebar{position:static;height:auto;border-right:none;border-bottom:var(--ds-border-w) var(--ds-border-style) var(--ds-border)}.studio-main{padding:var(--ds-space-4)}}
  </style>
</head>
<body>
  <div class="studio">
    <aside class="studio-sidebar">
      <div class="studio-brand"><h1>Design System Studio</h1><p>Components, semantics, and live theme authoring.</p></div>
      <div class="ds-field">
        <label class="ds-label" for="themeSelect">Base Theme</label>
        <select id="themeSelect" class="ds-select">
          <option value="steel-night">Steel Night</option>
          <option value="paper-mint">Paper Mint</option>
          <option value="amber-terminal">Amber Terminal</option>
          <option value="neon-grid">Neon Grid</option>
          <option value="mono-slate">Mono Slate</option>
          <option value="tech-grid">Tech Grid</option>
          <option value="skeuo-panel">Skeuo Panel</option>
          <option value="industrial-terminal">Industrial Terminal</option>
          <option value="velvet-touch">Velvet Touch</option>
          <option value="eva-wireframe">Eva Wireframe</option>
          <option value="eva-unit-01">Eva Unit-01</option>
          <option value="saturn-alloy">Saturn Alloy</option>
        </select>
      </div>
      <hr class="studio-divider">
      <nav class="studio-nav" role="tablist" aria-label="Studio sections">
        <button class="ds-btn studio-tab" type="button" data-panel="guide" aria-selected="true">Guide</button>
        <button class="ds-btn studio-tab" type="button" data-panel="builder" aria-selected="false">Theme Builder</button>
        <button class="ds-btn studio-tab" type="button" data-panel="components" aria-selected="false">Components</button>
      </nav>
      <p class="ds-muted">Builder edits apply in real time to this preview page.</p>
    </aside>

    <main class="studio-main">
      <section id="panel-components" class="studio-panel ds-stack" hidden>
        <article class="ds-card ds-stack">
          <div><h2 class="ds-card-title">Component Library</h2><p class="ds-card-subtitle">Preview how tokens affect common UI patterns.</p></div>
          <div class="ds-grid ds-grid-2">
            <article class="ds-card ds-stack">
              <h3 class="ds-card-title">Buttons and States</h3>
              <div class="ds-toolbar"><button class="ds-btn ds-btn-primary" type="button">Primary</button><button class="ds-btn" type="button">Secondary</button><button class="ds-btn ds-btn-danger" type="button">Danger</button><button class="ds-btn ds-btn-ghost" type="button">Ghost</button><button class="ds-btn ds-btn-sm" type="button">Small</button><button class="ds-btn" type="button" disabled>Disabled</button><button class="ds-btn is-loading" type="button">Loading...</button></div>
              <div class="pill-row"><span class="pill">Pill</span><span class="ds-badge success">Status</span><span class="ds-chip">Chip</span><span class="ds-chip ds-chip-accent">Accent Chip</span></div>
            </article>
            <article class="ds-card ds-stack">
              <h3 class="ds-card-title">Inputs and Fields</h3>
              <div class="ds-field"><label class="ds-label" for="demoName">Name</label><input id="demoName" class="ds-input" type="text" placeholder="Project name"></div>
              <div class="ds-grid" style="grid-template-columns:1fr 1fr;"><div class="ds-field"><label class="ds-label" for="demoEmail">Email</label><input id="demoEmail" class="ds-input" type="email" placeholder="name@example.com"></div><div class="ds-field"><label class="ds-label" for="demoRole">Role</label><select id="demoRole" class="ds-select"><option>Designer</option><option>Developer</option><option>Product</option></select></div></div>
              <div class="ds-field"><label class="ds-label" for="demoNotes">Notes</label><textarea id="demoNotes" class="ds-textarea" placeholder="Notes..."></textarea></div>
            </article>
          </div>
          <div class="ds-grid ds-grid-2">
            <article class="ds-card ds-stack">
              <h3 class="ds-card-title">Controls</h3>
              <div class="control-grid">
                <div class="control-box"><strong>Checkboxes</strong><label><input type="checkbox" checked> Default checked</label><label><input type="checkbox"> Default unchecked</label></div>
                <div class="control-box"><strong>Radio</strong><label><input type="radio" name="demoPlan" checked> Monthly</label><label><input type="radio" name="demoPlan"> Annual</label></div>
                <div class="control-box"><strong>Toggle</strong><label class="ds-switch"><input type="checkbox" checked><span class="ds-switch-track"></span><span>Auto sync</span></label></div>
                <div class="control-box"><strong>Slider</strong><input id="sliderDemo" type="range" min="0" max="100" value="60"><span class="ds-muted mono" id="sliderDemoValue">60</span></div>
                <div class="control-box"><strong>Segmented</strong><div class="seg" id="segDemo"><button type="button" aria-pressed="true">Day</button><button type="button" aria-pressed="false">Week</button><button type="button" aria-pressed="false">Month</button></div></div>
                <div class="control-box"><strong>Control Arrows</strong><div class="arrow-control"><button class="ds-btn ds-arrow-btn" id="arrowDownBtn" type="button">v</button><span class="arrow-value" id="arrowValue">0</span><button class="ds-btn ds-arrow-btn" id="arrowUpBtn" type="button">^</button></div></div>
              </div>
            </article>

            <article class="ds-card ds-stack">
              <h3 class="ds-card-title">Scrollbars and Popouts</h3>
              <div class="scroll-demo ds-scroll" id="scrollDemo"><div class="ds-chip">Scrollable item 1</div><div class="ds-chip">Scrollable item 2</div><div class="ds-chip">Scrollable item 3</div><div class="ds-chip">Scrollable item 4</div><div class="ds-chip">Scrollable item 5</div><div class="ds-chip">Scrollable item 6</div><div class="ds-chip">Scrollable item 7</div><div class="ds-chip">Scrollable item 8</div><div class="ds-chip">Scrollable item 9</div><div class="ds-chip">Scrollable item 10</div></div>
              <div class="ds-scroll" style="overflow-x:auto;overflow-y:hidden;border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-2);padding:var(--ds-space-2);white-space:nowrap;">
                <span class="ds-chip">Horizontal 01</span> <span class="ds-chip">Horizontal 02</span> <span class="ds-chip">Horizontal 03</span> <span class="ds-chip">Horizontal 04</span> <span class="ds-chip">Horizontal 05</span> <span class="ds-chip">Horizontal 06</span> <span class="ds-chip">Horizontal 07</span> <span class="ds-chip">Horizontal 08</span> <span class="ds-chip">Horizontal 09</span> <span class="ds-chip">Horizontal 10</span>
              </div>
              <div class="ds-toolbar">
                <div class="ds-dropdown" id="actionsDropdown"><button class="ds-btn" id="dropdownToggle" type="button" aria-expanded="false">Open Menu</button><div class="ds-dropdown-menu" role="menu" aria-label="Actions menu"><button class="ds-menu-item" type="button">New file</button><button class="ds-menu-item" type="button">Duplicate</button><button class="ds-menu-item" type="button">Archive</button></div></div>
                <div class="ds-popover-wrap" id="helpPopover"><button class="ds-btn" id="popoverToggle" type="button">Show Popover</button><div class="ds-popover" role="status">Quick contextual help lives here.</div></div>
              </div>
              <div class="ds-toolbar"><button class="ds-btn ds-btn-primary" id="openModalBtn" type="button">Open Modal</button><button class="ds-btn" id="openDrawerBtn" type="button">Open Drawer</button><button class="ds-btn" id="toastSuccessBtn" type="button">Toast Success</button><button class="ds-btn ds-btn-danger" id="toastErrorBtn" type="button">Toast Error</button></div>
            </article>
          </div>

          <div class="ds-grid ds-grid-2">
            <article class="ds-card ds-stack">
              <h3 class="ds-card-title">Date and Time</h3>
              <div class="ds-grid" style="grid-template-columns:1fr 1fr;">
                <div class="ds-field"><label class="ds-label" for="demoDate">Date</label><input id="demoDate" class="ds-input" type="date"></div>
                <div class="ds-field"><label class="ds-label" for="demoTime">Time</label><input id="demoTime" class="ds-input" type="time"></div>
              </div>
              <div class="ds-grid" style="grid-template-columns:1fr 1fr;">
                <div class="ds-field"><label class="ds-label" for="demoWeek">Week</label><input id="demoWeek" class="ds-input" type="week"></div>
                <div class="ds-field"><label class="ds-label" for="demoMonth">Month</label><input id="demoMonth" class="ds-input" type="month"></div>
              </div>
              <div class="ds-field"><label class="ds-label" for="demoDateTime">Date + Time</label><input id="demoDateTime" class="ds-input" type="datetime-local"></div>
            </article>
            <article class="ds-card ds-stack">
              <h3 class="ds-card-title">Mini Calendar and Progress</h3>
              <div class="calendar-grid" aria-label="Mini calendar">
                <span class="head">Su</span><span class="head">Mo</span><span class="head">Tu</span><span class="head">We</span><span class="head">Th</span><span class="head">Fr</span><span class="head">Sa</span>
                <span class="muted">26</span><span class="muted">27</span><span class="muted">28</span><span>1</span><span>2</span><span>3</span><span>4</span>
                <span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span><span>11</span>
                <span>12</span><span>13</span><span class="today">14</span><span>15</span><span>16</span><span>17</span><span>18</span>
              </div>
              <div class="ds-field"><label class="ds-label" for="demoProgress">Progress</label><progress id="demoProgress" class="ds-progress" value="62" max="100"></progress></div>
              <div class="ds-field"><label class="ds-label" for="demoMeter">Meter</label><meter id="demoMeter" class="ds-meter" value="0.68" min="0" max="1" low="0.4" high="0.8" optimum="0.7"></meter></div>
            </article>
          </div>

          <article class="ds-card ds-stack">
            <h3 class="ds-card-title">Table</h3>
            <div class="ds-table-wrap"><table class="ds-table"><thead><tr><th>Project</th><th>Owner</th><th>Status</th><th>Updated</th></tr></thead><tbody><tr><td>Quickdash</td><td>SV</td><td><span class="ds-badge success">Active</span></td><td>Today</td></tr><tr><td>Nomz</td><td>SV</td><td><span class="ds-badge warning">Review</span></td><td>Yesterday</td></tr><tr><td>MapitMine</td><td>SV</td><td><span class="ds-badge danger">Blocked</span></td><td>2 days ago</td></tr></tbody></table></div>
          </article>

          <article class="ds-card ds-stack">
            <h3 class="ds-card-title">Charts and Diagrams</h3>
            <div class="viz-grid">
              <div class="viz-panel">
                <strong>Line + Area</strong>
                <svg class="viz-svg" viewBox="0 0 320 170" role="img" aria-label="Line chart">
                  <path class="viz-gridline" d="M36 30H300M36 70H300M36 110H300M36 150H300"></path>
                  <path class="viz-axis" d="M36 20V150H300"></path>
                  <path class="viz-area" d="M36 130 L76 112 L116 94 L156 102 L196 74 L236 86 L276 48 L300 56 L300 150 L36 150 Z"></path>
                  <path class="viz-line" d="M36 130 L76 112 L116 94 L156 102 L196 74 L236 86 L276 48 L300 56"></path>
                </svg>
              </div>
              <div class="viz-panel">
                <strong>Bar Chart</strong>
                <svg class="viz-svg" viewBox="0 0 320 170" role="img" aria-label="Bar chart">
                  <path class="viz-gridline" d="M30 30H300M30 70H300M30 110H300M30 150H300"></path>
                  <path class="viz-axis" d="M30 20V150H300"></path>
                  <rect class="viz-bar" x="48" y="92" width="28" height="58" rx="3"></rect>
                  <rect class="viz-bar alt" x="88" y="70" width="28" height="80" rx="3"></rect>
                  <rect class="viz-bar" x="128" y="52" width="28" height="98" rx="3"></rect>
                  <rect class="viz-bar alt" x="168" y="84" width="28" height="66" rx="3"></rect>
                  <rect class="viz-bar" x="208" y="44" width="28" height="106" rx="3"></rect>
                  <rect class="viz-bar alt" x="248" y="62" width="28" height="88" rx="3"></rect>
                </svg>
              </div>
              <div class="viz-panel">
                <strong>Donut</strong>
                <svg class="viz-svg" viewBox="0 0 320 170" role="img" aria-label="Donut chart">
                  <g transform="translate(160 86)">
                    <circle class="viz-ring-bg" r="48"></circle>
                    <circle class="viz-ring-main" r="48" pathLength="100" stroke-dasharray="64 100" transform="rotate(-90)"></circle>
                    <circle class="viz-ring-sub" r="48" pathLength="100" stroke-dasharray="22 100" stroke-dashoffset="-64" transform="rotate(-90)"></circle>
                    <text x="0" y="4" text-anchor="middle" fill="var(--ds-text)" font-size="18" font-family="var(--ds-font-mono)">64%</text>
                  </g>
                </svg>
              </div>
              <div class="viz-panel">
                <strong>Flow Diagram</strong>
                <svg class="viz-svg" viewBox="0 0 320 170" role="img" aria-label="Flow diagram">
                  <path class="viz-flow-link" d="M94 42H140M180 42H226M94 120H140M180 120H226M160 60V102"></path>
                  <rect class="viz-flow-node" x="22" y="24" width="72" height="36" rx="8"></rect>
                  <rect class="viz-flow-node" x="140" y="24" width="40" height="36" rx="8"></rect>
                  <rect class="viz-flow-node" x="226" y="24" width="72" height="36" rx="8"></rect>
                  <rect class="viz-flow-node" x="22" y="102" width="72" height="36" rx="8"></rect>
                  <rect class="viz-flow-node" x="140" y="102" width="40" height="36" rx="8"></rect>
                  <rect class="viz-flow-node" x="226" y="102" width="72" height="36" rx="8"></rect>
                  <text x="58" y="46" text-anchor="middle" fill="var(--ds-text)" font-size="11">Source</text>
                  <text x="160" y="46" text-anchor="middle" fill="var(--ds-text)" font-size="11">ETL</text>
                  <text x="262" y="46" text-anchor="middle" fill="var(--ds-text)" font-size="11">Store</text>
                  <text x="58" y="124" text-anchor="middle" fill="var(--ds-text)" font-size="11">Batch</text>
                  <text x="160" y="124" text-anchor="middle" fill="var(--ds-text)" font-size="11">Map</text>
                  <text x="262" y="124" text-anchor="middle" fill="var(--ds-text)" font-size="11">Serve</text>
                </svg>
              </div>
            </div>
          </article>
        </article>
      </section>

      <section id="panel-guide" class="studio-panel ds-stack">
        <article class="ds-card ds-stack" id="guide-intro">
          <h2 class="ds-card-title">Getting Started</h2>
          <p class="ds-card-subtitle">This repository gives you a reusable tokenized design system with composable theme presets.</p>
          <div class="ds-grid" style="grid-template-columns:repeat(auto-fit,minmax(280px,1fr));">
            <div class="ds-note">
              <strong>Introduction</strong>
              <p class="ds-muted">Choose a base theme for orientation, then use the Theme Builder to compose Color Family + Hue + Style + Scale. Export your theme and add it to your projects.</p>
            </div>
            <div class="ds-note">
              <strong>Table of Contents</strong>
              <p class="ds-muted mono">1. Getting Started<br>2. Token Philosophy<br>3. Token Encyclopedia<br>4. Native Controls and Scrollbars<br>5. Overlay Behavior (Modal/Popover)<br>6. GitHub Integration<br>7. Local Package Export</p>
            </div>
          </div>
        </article>
        <article class="ds-card ds-stack">
          <h2 class="ds-card-title">Token Philosophy and Logic</h2>
          <p class="ds-card-subtitle">How and why this system is structured.</p>
          <div class="guide-grid">
            <article class="ds-card ds-stack"><h3>Core Philosophy</h3><p class="ds-muted">Themes should change personality without rewriting components. Components should never directly depend on fixed colors or one-off dimensions.</p><pre class="ds-code mono">Component class
  -> component tokens (button/input/card)
     -> semantic tokens (bg/text/border/accent)
        -> theme values</pre></article>
            <article class="ds-card ds-stack"><h3>Token Creation Rules</h3><p class="ds-muted">Create tokens when the value has reuse potential or must vary by theme family.</p><pre class="ds-code mono">Use token when:
- value appears in 2+ components
- value needs theme variation
- value represents intent (warning, accent)

Avoid token when:
- one-off layout local to one element</pre></article>
            <article class="ds-card ds-stack"><h3>Preset Architecture</h3><p class="ds-muted">Builder presets are organized by categories so combinations are composable.</p><pre class="ds-code mono">Color Family + Hue -> full semantic palette behavior
Style Preset (terminal|technical|paper|skeuo|glassmorph|material)
  -> geometry + depth language
Scale Preset -> size + spacing density

Final custom theme = Color Family + Hue + Style + Scale + manual edits</pre></article>
            <article class="ds-card ds-stack"><h3>Preset Effect Map</h3><p class="ds-muted">How each preset layer modifies tokens and aliases.</p><pre class="ds-code mono">Color Family:
- contrast model (light/dark, mono/bold)
- semantic intent tuning (success/warning/danger)

Hue:
- sets primary hue anchor
- combines with family behavior to generate semantic palette

Style:
- shape, border language, shadows, textures
- component token overrides (button/input/card)

Scale:
- density, control height, spacing cadence

Alias flow:
component token -> semantic token -> foundation token
ex: --ds-btn-bg -> --ds-bg-raised -> --ds-bg

Preset combo examples:
- electric + cyan + hud-glow + compact (cyber HUD)
- paper + emerald + skeuo + standard (premium productivity)
- monochrome + gray + neo-brutal + compact (ops console)
- pastel + rose + material + comfortable (friendly SaaS)</pre></article>
            <article class="ds-card ds-stack"><h3>Implementation Pattern</h3><p class="ds-muted">For new components, define local component tokens first, then map them to semantic tokens.</p><pre class="ds-code mono">.ds-new {
  background: var(--ds-new-bg);
  border-color: var(--ds-new-border);
}

:root {
  --ds-new-bg: var(--ds-bg-raised);
  --ds-new-border: var(--ds-border);
}</pre></article>
          </div>
        </article>

        <article class="ds-card ds-stack token-table">
          <h2 class="ds-card-title">Token Encyclopedia</h2>
          <p class="ds-card-subtitle">Reference of key token families and expected usage.</p>
          <div class="ds-table-wrap"><table class="ds-table"><thead><tr><th>Category</th><th>Token Family</th><th>Purpose</th><th>Examples</th></tr></thead><tbody>
            <tr><td>Foundation</td><td><code>--ds-space-*</code></td><td>Global spacing scale</td><td>card padding, gaps, control spacing</td></tr>
            <tr><td>Foundation</td><td><code>--ds-radius-*</code></td><td>Shape system</td><td>soft vs technical corners</td></tr>
            <tr><td>Foundation</td><td><code>--ds-fs-*</code>, <code>--ds-lh-base</code></td><td>Type scale and rhythm</td><td>labels, body, headings</td></tr>
            <tr><td>Semantic</td><td><code>--ds-bg*</code></td><td>Surface hierarchy</td><td>page, elevated panels, controls</td></tr>
            <tr><td>Semantic</td><td><code>--ds-text*</code></td><td>Text hierarchy</td><td>primary text, muted metadata</td></tr>
            <tr><td>Semantic</td><td><code>--ds-border*</code></td><td>Outline hierarchy</td><td>default and strong separators</td></tr>
            <tr><td>Semantic</td><td><code>--ds-accent</code>, <code>--ds-focus</code></td><td>Interaction cues</td><td>active tabs, focus rings, key actions</td></tr>
            <tr><td>Semantic</td><td><code>--ds-success|warning|danger|info</code></td><td>Intent states</td><td>alerts, badges, validation states</td></tr>
            <tr><td>Component</td><td><code>--ds-btn-*</code></td><td>Button behavior/look</td><td>primary gradient, press depth, border</td></tr>
            <tr><td>Component</td><td><code>--ds-input-*</code></td><td>Input behavior/look</td><td>field background, placeholder, inset depth</td></tr>
            <tr><td>Component</td><td><code>--ds-card-*</code></td><td>Container style</td><td>panel contrast, border, shadow</td></tr>
            <tr><td>Component</td><td><code>--ds-color-input-*|--ds-check-*|--ds-range-*|--ds-spin-*</code></td><td>Native control theming</td><td>color picker shape, checkbox/radio fills, slider thumb/track, number steppers</td></tr>
            <tr><td>Style</td><td><code>--ds-border-w</code>, <code>--ds-border-style</code></td><td>Visual language</td><td>minimal 1px vs industrial 2px frames</td></tr>
            <tr><td>Style</td><td><code>--ds-btn-shadow*</code>, <code>--ds-input-shadow</code></td><td>Depth model</td><td>flat, technical, skeuo</td></tr>
            <tr><td>Style</td><td><code>--ds-body-bg-image</code>, <code>--ds-card-bg-image</code></td><td>Material texture</td><td>glass, grain, scanline effects</td></tr>
            <tr><td>Style</td><td><code>--ds-scrollbar-*</code></td><td>Scrollbar appearance</td><td>component scrollers and page viewport scrollbar</td></tr>
            <tr><td>Scale</td><td><code>--ds-control-h*</code>, <code>--ds-layout-gap</code>, <code>--ds-card-pad</code></td><td>UI density</td><td>compact dashboards vs spacious tools</td></tr>
          </tbody></table></div>
        </article>
        <article class="ds-card ds-stack">
          <h2 class="ds-card-title">Native Controls and Overlay Behavior</h2>
          <div class="guide-grid">
            <article class="ds-card ds-stack">
              <h3>Native Controls and Viewport Scrollbar</h3>
              <pre class="ds-code mono">Number inputs, checkboxes, radios, range sliders,
and color pickers are tokenized via:
- --ds-color-input-*
- --ds-check-*
- --ds-range-*
- --ds-spin-*

Page scrollbar theming:
- html/body scrollbar uses --ds-scrollbar-*
- local scroll regions use .ds-scroll + same tokens

Note:
Browser chrome (tab bar / app frame scrollbar) is OS/browser UI
and cannot be themed from site CSS.</pre>
            </article>
            <article class="ds-card ds-stack">
              <h3>Modal and Popover Placement</h3>
              <pre class="ds-code mono">Modal behavior:
- .ds-modal uses full-viewport centering
- .ds-modal-panel is centered with no fixed top offset

Popover behavior:
- Auto places below trigger by default
- Flips above when viewport space below is insufficient
- Horizontal alignment shifts start/end to avoid clipping

Goal:
Do not occlude the trigger element when contextual help opens.</pre>
            </article>
          </div>
        </article>
        <article class="ds-card ds-stack" id="guide-usage">
          <h2 class="ds-card-title">Using This Repository In Projects</h2>
          <div class="guide-grid">
            <article class="ds-card ds-stack">
              <h3>GitHub Workflow</h3>
              <pre class="ds-code mono">1. Clone this repository
2. Copy _DesignSystem into your app repo
3. Link your app HTML:
   &lt;link rel="stylesheet" href="./_DesignSystem/theme.css"&gt;
4. Set the theme on root:
   &lt;html data-theme="steel-night"&gt;
5. Append custom exported themes to:
   _DesignSystem/css/themes.css</pre>
            </article>
            <article class="ds-card ds-stack">
              <h3>Local Package Workflow</h3>
              <pre class="ds-code mono">1. Build your theme in Theme Builder
2. Click Generate Export
3. Click Download Theme Package
4. Drag extracted files into your project folder
5. Follow INSTALL.md in the package</pre>
            </article>
          </div>
        </article>
      </section>
      <section id="panel-builder" class="studio-panel ds-stack" hidden>
        <article class="ds-card ds-stack">
          <div><h2 class="ds-card-title">Theme Builder</h2><p class="ds-card-subtitle">Load modular presets (Color Family + Hue + Style + Scale), then tune tokens and export a custom theme block.</p></div>
          <div class="preset-grid ds-card">
            <h3 class="ds-card-title">Preset Loader</h3>
            <div class="ds-grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));">
              <div class="ds-field"><label class="ds-label" for="familyPresetSelect">Color Family</label><select id="familyPresetSelect" class="ds-select"></select></div><div class="ds-field"><label class="ds-label" for="huePresetSelect">Hue</label><select id="huePresetSelect" class="ds-select"></select></div>
              <div class="ds-field"><label class="ds-label" for="stylePresetSelect">Style Preset</label><select id="stylePresetSelect" class="ds-select"></select></div>
              <div class="ds-field"><label class="ds-label" for="scalePresetSelect">Scale Preset</label><select id="scalePresetSelect" class="ds-select"></select></div>
            </div>
            <div class="ds-toolbar"><button class="ds-btn ds-btn-primary" id="applyPresetBtn" type="button">Apply Preset Combination</button><button class="ds-btn ds-btn-danger" id="resetOverridesBtn" type="button">Reset Custom Overrides</button></div>
          </div>
          <div class="ds-field"><label class="ds-label" for="themeNameInput">Theme Name</label><input id="themeNameInput" class="ds-input" type="text" value="custom-theme" placeholder="custom-theme"></div>
          <div class="builder-grid" id="builderGroups"></div>
          <div class="ds-stack"><label class="ds-label" for="themeExportOutput">Exported Theme Block</label><textarea id="themeExportOutput" class="ds-textarea builder-output" readonly></textarea><div class="ds-toolbar"><button class="ds-btn ds-btn-primary" id="exportThemeBtn" type="button">Generate Export</button><button class="ds-btn" id="copyExportBtn" type="button">Copy Export</button><button class="ds-btn" id="downloadPackageBtn" type="button">Download Theme Package</button></div></div>
        </article>
      </section>
    </main>
  </div>

  <dialog id="modal" class="ds-modal"><div class="ds-modal-panel ds-stack"><div><h3 class="ds-card-title">Confirm Action</h3><p class="ds-muted">This is a reusable modal container for important decisions.</p></div><div class="ds-toolbar"><button class="ds-btn" id="closeModalBtn" type="button">Cancel</button><button class="ds-btn ds-btn-primary" id="confirmModalBtn" type="button">Confirm</button></div></div></dialog>
  <dialog id="drawer" class="ds-drawer"><div class="ds-drawer-panel ds-stack"><div><h3 class="ds-card-title">Side Panel</h3><p class="ds-muted">Use this as a settings drawer, inspector, or history view.</p></div><div class="ds-field"><label class="ds-label" for="drawerInput">Quick note</label><input id="drawerInput" class="ds-input" type="text" placeholder="Type here"></div><button class="ds-btn" id="closeDrawerBtn" type="button">Close Drawer</button></div></dialog>
  <dialog id="resetConfirmDialog" class="ds-modal"><div class="ds-modal-panel ds-stack"><div><h3 class="ds-card-title">Reset Theme Overrides?</h3><p class="ds-muted">This will clear all manual token edits and reapply the mapped preset recipe for the selected base theme.</p></div><label class="ds-check"><input type="checkbox" id="skipResetConfirmChk"> Do not show again</label><div class="ds-toolbar"><button class="ds-btn" id="cancelResetBtn" type="button">Cancel</button><button class="ds-btn ds-btn-danger" id="confirmResetBtn" type="button">Reset Overrides</button></div></div></dialog>
  <dialog id="tokenInfoDialog" class="ds-modal"><div class="ds-modal-panel ds-stack"><div><h3 class="ds-card-title" id="tokenInfoTitle">Token details</h3><p class="ds-muted" id="tokenInfoHint">How this token is used in the design system.</p></div><div class="token-info-grid"><div><strong class="ds-label ds-label-block">Token</strong><code id="tokenInfoToken"></code></div><div><strong class="ds-label ds-label-block">Current assignment</strong><code id="tokenInfoAssignment"></code></div><div><strong class="ds-label ds-label-block">Usage</strong><p class="ds-muted" id="tokenInfoUsage"></p></div></div><div class="ds-toolbar"><button class="ds-btn" id="closeTokenInfoBtn" type="button">Close</button><button class="ds-btn ds-btn-primary" id="copyTokenInfoBtn" type="button">Copy assignment</button></div></div></dialog>
  <div class="ds-toast-stack" id="toastStack" aria-live="polite"></div>

  <script>
    (function () {
      const root = document.documentElement;
      const storageKey = "ds-theme";
      const resetConfirmKey = "ds-skip-reset-confirm";
      const themeSelect = document.getElementById("themeSelect");
      const controlMap = new Map();
      const tokenGroups = [
        { name: "Semantic Colors", controls: [
          { token: "--ds-bg", type: "color" }, { token: "--ds-bg-elevated", type: "color" }, { token: "--ds-bg-raised", type: "color" }, { token: "--ds-bg-soft", type: "color" },
          { token: "--ds-text", type: "color" }, { token: "--ds-text-muted", type: "color" }, { token: "--ds-text-inverse", type: "color" },
          { token: "--ds-border", type: "color" }, { token: "--ds-border-strong", type: "color" },
          { token: "--ds-accent", type: "color" }, { token: "--ds-accent-strong", type: "color" }, { token: "--ds-focus", type: "color" },
          { token: "--ds-success", type: "color" }, { token: "--ds-warning", type: "color" }, { token: "--ds-danger", type: "color" }, { token: "--ds-info", type: "color" }
        ]},
        { name: "Typography", controls: [
          { token: "--ds-font-sans", type: "select", options: ["\"Inter\", \"Segoe UI\", Roboto, Arial, sans-serif", "\"Space Mono\", Consolas, \"Courier New\", monospace", "\"Georgia\", \"Times New Roman\", serif", "\"Trebuchet MS\", \"Segoe UI\", sans-serif", "\"Arial Narrow\", \"Segoe UI\", sans-serif"] },
          { token: "--ds-font-mono", type: "select", options: ["\"Space Mono\", Consolas, \"Courier New\", monospace", "\"Fira Code\", Consolas, monospace", "\"JetBrains Mono\", Consolas, monospace"] },
          { token: "--ds-fs-1", type: "length", unit: "px" }, { token: "--ds-fs-2", type: "length", unit: "px" }, { token: "--ds-fs-3", type: "length", unit: "px" },
          { token: "--ds-fs-4", type: "length", unit: "px" }, { token: "--ds-fs-5", type: "length", unit: "px" },
          { token: "--ds-lh-base", type: "number", step: "0.01" }, { token: "--ds-label-spacing", type: "length", unit: "em" }, { token: "--ds-label-transform", type: "select", options: ["uppercase", "none", "capitalize"] }
        ]},
        { name: "Density and Layout", controls: [
          { token: "--ds-space-1", type: "length", unit: "px" }, { token: "--ds-space-2", type: "length", unit: "px" }, { token: "--ds-space-3", type: "length", unit: "px" },
          { token: "--ds-space-4", type: "length", unit: "px" }, { token: "--ds-space-5", type: "length", unit: "px" }, { token: "--ds-space-6", type: "length", unit: "px" },
          { token: "--ds-space-8", type: "length", unit: "px" }, { token: "--ds-layout-gap", type: "length", unit: "px" }, { token: "--ds-card-pad", type: "length", unit: "px" },
          { token: "--ds-control-h", type: "length", unit: "px" }, { token: "--ds-control-h-sm", type: "length", unit: "px" }, { token: "--ds-control-hit-min", type: "length", unit: "px" }
        ]},
        { name: "Geometry and Borders", controls: [
          { token: "--ds-border-w", type: "length", unit: "px" }, { token: "--ds-border-style", type: "select", options: ["solid", "dashed", "dotted", "double"] },
          { token: "--ds-radius-1", type: "length", unit: "px" }, { token: "--ds-radius-2", type: "length", unit: "px" }, { token: "--ds-radius-3", type: "length", unit: "px" },
          { token: "--ds-radius-4", type: "length", unit: "px" }, { token: "--ds-radius-pill", type: "length", unit: "px" },
          { token: "--ds-btn-radius", type: "length", unit: "px" }, { token: "--ds-card-radius", type: "length", unit: "px" }
        ]},
        { name: "Surface and Depth", controls: [
          { token: "--ds-shadow-sm", type: "shadow" }, { token: "--ds-shadow-md", type: "shadow" }, { token: "--ds-card-shadow", type: "shadow" },
          { token: "--ds-btn-shadow", type: "shadow" }, { token: "--ds-btn-shadow-hover", type: "shadow" }, { token: "--ds-btn-shadow-active", type: "shadow" },
          { token: "--ds-input-shadow", type: "shadow" }, { token: "--ds-bg-overlay", type: "rgba" }, { token: "--ds-body-bg-image", type: "text" }, { token: "--ds-card-bg-image", type: "text" }
        ]},
        { name: "Buttons and Inputs", controls: [
          { token: "--ds-btn-h", type: "length", unit: "px" }, { token: "--ds-btn-h-sm", type: "length", unit: "px" }, { token: "--ds-btn-pad-x", type: "length", unit: "px" },
          { token: "--ds-arrow-btn-size", type: "length", unit: "px" }, { token: "--ds-arrow-btn-radius", type: "length", unit: "px" }, { token: "--ds-arrow-btn-font-size", type: "length", unit: "px" },
          { token: "--ds-btn-bg", type: "paint" }, { token: "--ds-btn-bg-hover", type: "paint" }, { token: "--ds-btn-border", type: "color" }, { token: "--ds-btn-text", type: "color" },
          { token: "--ds-btn-primary-bg", type: "paint" }, { token: "--ds-btn-primary-bg-hover", type: "paint" }, { token: "--ds-btn-primary-border", type: "color" }, { token: "--ds-btn-primary-text", type: "color" },
          { token: "--ds-btn-press-transform", type: "translateY" }, { token: "--ds-input-bg", type: "paint" }, { token: "--ds-input-border", type: "color" }, { token: "--ds-input-text", type: "color" }, { token: "--ds-input-placeholder", type: "color" }
        ]},
        { name: "Native Controls", controls: [
          { token: "--ds-color-input-radius", type: "length", unit: "px" }, { token: "--ds-color-input-pad", type: "length", unit: "px" }, { token: "--ds-color-input-bg", type: "paint" }, { token: "--ds-color-input-shadow", type: "shadow" },
          { token: "--ds-check-size", type: "length", unit: "px" }, { token: "--ds-check-bg", type: "paint" }, { token: "--ds-check-border", type: "color" }, { token: "--ds-check-mark", type: "color" }, { token: "--ds-check-checked-bg", type: "color" },
          { token: "--ds-range-track-h", type: "length", unit: "px" }, { token: "--ds-range-track-bg", type: "paint" }, { token: "--ds-range-track-border", type: "color" },
          { token: "--ds-range-thumb-size", type: "length", unit: "px" }, { token: "--ds-range-thumb-bg", type: "paint" }, { token: "--ds-range-thumb-border", type: "color" }, { token: "--ds-range-thumb-shadow", type: "shadow" },
          { token: "--ds-number-pad-end", type: "length", unit: "px" }, { token: "--ds-spin-bg", type: "paint" }, { token: "--ds-spin-border", type: "color" }, { token: "--ds-spin-glyph", type: "color" }, { token: "--ds-spin-opacity", type: "number", step: "0.01" }, { token: "--ds-spin-opacity-active", type: "number", step: "0.01" }
        ]},
        { name: "Chips and Scrollbars", controls: [
          { token: "--ds-chip-bg", type: "paint" }, { token: "--ds-chip-border", type: "color" }, { token: "--ds-chip-text", type: "color" },
          { token: "--ds-scrollbar-size", type: "length", unit: "px" }, { token: "--ds-scrollbar-size-x", type: "length", unit: "px" }, { token: "--ds-scrollbar-size-y", type: "length", unit: "px" }, { token: "--ds-scrollbar-radius", type: "length", unit: "px" },
          { token: "--ds-scrollbar-thumb", type: "paint" }, { token: "--ds-scrollbar-track", type: "paint" }
        ]},
        { name: "Motion and Layers", controls: [
          { token: "--ds-dur-fast", type: "length", unit: "ms" }, { token: "--ds-dur-med", type: "length", unit: "ms" }, { token: "--ds-ease-standard", type: "bezier" },
          { token: "--ds-z-dropdown", type: "number", step: "1" }, { token: "--ds-z-sticky", type: "number", step: "1" }, { token: "--ds-z-drawer", type: "number", step: "1" },
          { token: "--ds-z-modal", type: "number", step: "1" }, { token: "--ds-z-toast", type: "number", step: "1" }
        ]}
      ];
      const huePresets={cyan:{h:190},magenta:{h:320},violet:{h:265},red:{h:4},green:{h:140},blue:{h:214},yellow:{h:52},lime:{h:88},amber:{h:38},teal:{h:176},orange:{h:26},rose:{h:346},emerald:{h:162},cobalt:{h:223},ultraviolet:{h:278},gray:{neutral:"gray"},steel:{neutral:"steel"},slate:{neutral:"slate"},black:{neutral:"black"},white:{neutral:"white"}};
      const colorFamilyPresets={monochrome:{mode:"dark",sat:8,bgL:10,elevL:14,raisedL:18,softL:22,textL:92,mutedL:72,borderL:30,borderStrongL:44,accentL:88,accentSat:6},bold:{mode:"dark",sat:78,bgL:9,elevL:13,raisedL:18,softL:23,textL:95,mutedL:76,borderL:31,borderStrongL:50,accentL:60,accentSat:92},paper:{mode:"light",sat:24,bgL:97,elevL:100,raisedL:94,softL:90,textL:14,mutedL:36,borderL:76,borderStrongL:62,accentL:42,accentSat:52},pastel:{mode:"light",sat:38,bgL:95,elevL:100,raisedL:92,softL:88,textL:16,mutedL:40,borderL:74,borderStrongL:60,accentL:56,accentSat:58},cathode:{mode:"dark",sat:92,bgL:7,elevL:10,raisedL:14,softL:18,textL:92,mutedL:72,borderL:26,borderStrongL:40,accentL:68,accentSat:100,glow:true},electric:{mode:"dark",sat:96,bgL:6,elevL:9,raisedL:13,softL:18,textL:96,mutedL:76,borderL:24,borderStrongL:38,accentL:72,accentSat:100,glow:true},noir:{mode:"dark",sat:26,bgL:5,elevL:8,raisedL:12,softL:16,textL:90,mutedL:66,borderL:22,borderStrongL:34,accentL:64,accentSat:58},frost:{mode:"light",sat:30,bgL:98,elevL:100,raisedL:96,softL:93,textL:18,mutedL:44,borderL:78,borderStrongL:62,accentL:50,accentSat:48},sunset:{mode:"dark",sat:74,bgL:8,elevL:12,raisedL:16,softL:21,textL:94,mutedL:74,borderL:30,borderStrongL:46,accentL:62,accentSat:88}};
      const stylePresets={terminal:{"--ds-font-sans":"\"Space Mono\", Consolas, \"Courier New\", monospace","--ds-radius-1":"2px","--ds-radius-2":"2px","--ds-radius-3":"4px","--ds-radius-4":"6px","--ds-radius-pill":"4px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-label-transform":"uppercase","--ds-label-spacing":"0.12em","--ds-card-shadow":"0 0 0 1px rgba(255,255,255,0.05) inset, 0 0 24px color-mix(in oklab,var(--ds-accent) 15%, transparent)","--ds-btn-shadow":"none","--ds-btn-shadow-hover":"none","--ds-btn-shadow-active":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 45%, transparent)","--ds-input-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 25%, transparent)","--ds-body-bg-image":"repeating-linear-gradient(0deg, rgba(255,255,255,0.012) 0px, rgba(255,255,255,0.012) 2px, transparent 2px, transparent 6px)","--ds-card-bg-image":"linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.05))"},technical:{"--ds-font-sans":"\"Space Mono\", Consolas, \"Courier New\", monospace","--ds-radius-1":"0px","--ds-radius-2":"0px","--ds-radius-3":"0px","--ds-radius-4":"0px","--ds-radius-pill":"0px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"none","--ds-btn-shadow":"none","--ds-btn-shadow-hover":"inset 0 0 0 1px var(--ds-accent)","--ds-btn-shadow-active":"inset 0 0 0 1px var(--ds-accent-strong)","--ds-input-shadow":"none","--ds-body-bg-image":"none","--ds-card-bg-image":"none","--ds-label-transform":"uppercase","--ds-label-spacing":"0.12em"},paper:{"--ds-radius-1":"5px","--ds-radius-2":"10px","--ds-radius-3":"14px","--ds-radius-4":"18px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 2px 10px rgba(40,45,35,0.08)","--ds-btn-shadow":"none","--ds-btn-shadow-hover":"none","--ds-btn-shadow-active":"none","--ds-input-shadow":"none","--ds-body-bg-image":"none","--ds-card-bg-image":"none","--ds-label-transform":"uppercase","--ds-label-spacing":"0.06em"},skeuo:{"--ds-radius-1":"5px","--ds-radius-2":"10px","--ds-radius-3":"14px","--ds-radius-4":"18px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 1px 0 rgba(255,255,255,0.7) inset, 0 10px 18px rgba(73,86,108,0.2)","--ds-btn-shadow":"0 1px 0 rgba(255,255,255,0.85) inset, 0 -1px 0 rgba(99,112,134,0.25) inset, 0 2px 4px rgba(71,85,107,0.22)","--ds-btn-shadow-hover":"0 1px 0 rgba(255,255,255,0.9) inset, 0 -1px 0 rgba(99,112,134,0.3) inset, 0 3px 6px rgba(71,85,107,0.22)","--ds-btn-shadow-active":"0 1px 2px rgba(67,77,96,0.35) inset","--ds-input-shadow":"0 1px 2px rgba(76,90,112,0.3) inset, 0 1px 0 rgba(255,255,255,0.8)","--ds-body-bg-image":"none","--ds-card-bg-image":"none","--ds-btn-press-transform":"translateY(1px)"},glassmorph:{"--ds-radius-1":"8px","--ds-radius-2":"14px","--ds-radius-3":"18px","--ds-radius-4":"24px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 8px 24px rgba(0,0,0,0.25)","--ds-btn-shadow":"0 1px 0 rgba(255,255,255,0.25) inset","--ds-btn-shadow-hover":"0 1px 0 rgba(255,255,255,0.35) inset","--ds-input-shadow":"0 1px 0 rgba(255,255,255,0.2) inset","--ds-body-bg-image":"radial-gradient(circle at 15% 10%, rgba(255,255,255,0.15), transparent 45%)","--ds-card-bg-image":"linear-gradient(145deg, rgba(255,255,255,0.2), rgba(255,255,255,0.04))","--ds-bg-overlay":"rgba(10,18,34,0.45)"},material:{"--ds-radius-1":"4px","--ds-radius-2":"10px","--ds-radius-3":"14px","--ds-radius-4":"18px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 2px 10px rgba(0,0,0,0.16)","--ds-btn-shadow":"0 1px 0 rgba(255,255,255,0.08) inset","--ds-btn-shadow-hover":"0 1px 0 rgba(255,255,255,0.12) inset","--ds-btn-shadow-active":"0 1px 2px rgba(0,0,0,0.2) inset","--ds-input-shadow":"none","--ds-body-bg-image":"none","--ds-card-bg-image":"none"},"hud-glow":{"--ds-font-sans":"\"Space Mono\", Consolas, \"Courier New\", monospace","--ds-radius-1":"2px","--ds-radius-2":"3px","--ds-radius-3":"4px","--ds-radius-4":"6px","--ds-radius-pill":"6px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-label-transform":"uppercase","--ds-label-spacing":"0.1em","--ds-card-shadow":"0 0 18px color-mix(in oklab,var(--ds-accent) 20%, transparent), inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 24%, transparent)","--ds-btn-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 30%, transparent), 0 0 10px color-mix(in oklab,var(--ds-accent) 22%, transparent)","--ds-btn-shadow-hover":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 44%, transparent), 0 0 14px color-mix(in oklab,var(--ds-accent) 34%, transparent)","--ds-btn-shadow-active":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 55%, transparent)","--ds-input-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 28%, transparent)","--ds-body-bg-image":"repeating-linear-gradient(-45deg, color-mix(in oklab, var(--ds-accent) 8%, transparent) 0 1px, transparent 1px 11px)","--ds-card-bg-image":"linear-gradient(180deg, color-mix(in oklab,var(--ds-bg-elevated) 92%, var(--ds-accent) 8%), var(--ds-bg-elevated))"},"neo-brutal":{"--ds-radius-1":"0px","--ds-radius-2":"0px","--ds-radius-3":"0px","--ds-radius-4":"0px","--ds-radius-pill":"0px","--ds-border-w":"2px","--ds-border-style":"solid","--ds-card-shadow":"6px 6px 0 color-mix(in oklab,var(--ds-accent) 25%, var(--ds-bg))","--ds-btn-shadow":"3px 3px 0 color-mix(in oklab,var(--ds-accent) 35%, var(--ds-bg))","--ds-btn-shadow-hover":"4px 4px 0 color-mix(in oklab,var(--ds-accent) 40%, var(--ds-bg))","--ds-btn-shadow-active":"1px 1px 0 color-mix(in oklab,var(--ds-accent) 40%, var(--ds-bg))","--ds-input-shadow":"none","--ds-body-bg-image":"none","--ds-card-bg-image":"none","--ds-btn-press-transform":"translateY(1px)"},arcade:{"--ds-font-sans":"\"Trebuchet MS\", \"Segoe UI\", sans-serif","--ds-radius-1":"6px","--ds-radius-2":"12px","--ds-radius-3":"16px","--ds-radius-4":"20px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 0 24px color-mix(in oklab,var(--ds-accent) 22%, transparent)","--ds-btn-shadow":"0 0 0 1px color-mix(in oklab,var(--ds-accent) 42%, transparent), 0 0 14px color-mix(in oklab,var(--ds-accent) 32%, transparent)","--ds-btn-shadow-hover":"0 0 0 1px color-mix(in oklab,var(--ds-accent) 56%, transparent), 0 0 18px color-mix(in oklab,var(--ds-accent) 45%, transparent)","--ds-btn-shadow-active":"inset 0 1px 2px rgba(0,0,0,0.25)","--ds-input-shadow":"0 0 0 1px color-mix(in oklab,var(--ds-accent) 24%, transparent) inset","--ds-body-bg-image":"radial-gradient(circle at 20% 12%, color-mix(in oklab, var(--ds-accent) 20%, transparent), transparent 45%)","--ds-card-bg-image":"linear-gradient(160deg, color-mix(in oklab,var(--ds-accent) 16%, transparent), transparent 50%)"},editorial:{"--ds-font-sans":"\"Georgia\", \"Times New Roman\", serif","--ds-radius-1":"2px","--ds-radius-2":"4px","--ds-radius-3":"6px","--ds-radius-4":"8px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 1px 0 rgba(0,0,0,0.05), 0 6px 14px rgba(0,0,0,0.08)","--ds-btn-shadow":"none","--ds-btn-shadow-hover":"none","--ds-btn-shadow-active":"none","--ds-input-shadow":"none","--ds-body-bg-image":"none","--ds-card-bg-image":"none","--ds-label-transform":"none","--ds-label-spacing":"0.02em"}};
      const scalePresets={compact:{"--ds-space-1":"3px","--ds-space-2":"6px","--ds-space-3":"9px","--ds-space-4":"12px","--ds-space-5":"16px","--ds-space-6":"20px","--ds-space-8":"26px","--ds-layout-gap":"12px","--ds-card-pad":"12px","--ds-control-h":"32px","--ds-control-h-sm":"28px","--ds-fs-1":"11px","--ds-fs-2":"13px","--ds-fs-3":"15px","--ds-fs-4":"18px","--ds-fs-5":"24px"},standard:{"--ds-space-1":"4px","--ds-space-2":"8px","--ds-space-3":"12px","--ds-space-4":"16px","--ds-space-5":"20px","--ds-space-6":"24px","--ds-space-8":"32px","--ds-layout-gap":"16px","--ds-card-pad":"16px","--ds-control-h":"38px","--ds-control-h-sm":"32px","--ds-fs-1":"12px","--ds-fs-2":"14px","--ds-fs-3":"16px","--ds-fs-4":"20px","--ds-fs-5":"28px"},comfortable:{"--ds-space-1":"5px","--ds-space-2":"10px","--ds-space-3":"14px","--ds-space-4":"20px","--ds-space-5":"24px","--ds-space-6":"30px","--ds-space-8":"38px","--ds-layout-gap":"20px","--ds-card-pad":"20px","--ds-control-h":"44px","--ds-control-h-sm":"36px","--ds-fs-1":"13px","--ds-fs-2":"15px","--ds-fs-3":"18px","--ds-fs-4":"22px","--ds-fs-5":"32px"}};
      const baseThemePresetMap={"steel-night":{family:"bold",hue:"steel",style:"technical",scale:"standard"},"paper-mint":{family:"paper",hue:"green",style:"paper",scale:"standard"},"amber-terminal":{family:"cathode",hue:"amber",style:"terminal",scale:"compact"},"neon-grid":{family:"cathode",hue:"cyan",style:"terminal",scale:"standard"},"mono-slate":{family:"monochrome",hue:"gray",style:"technical",scale:"standard"},"tech-grid":{family:"bold",hue:"blue",style:"technical",scale:"compact"},"skeuo-panel":{family:"paper",hue:"blue",style:"skeuo",scale:"standard"},"industrial-terminal":{family:"cathode",hue:"lime",style:"technical",scale:"compact"}};
      Object.assign(huePresets,{platinum:{neutral:"steel"},"signal-red":{h:2},glacier:{h:198}});
      Object.assign(colorFamilyPresets,{
        neumorph:{mode:"light",sat:18,bgL:92,elevL:95,raisedL:90,softL:86,textL:24,mutedL:44,borderL:78,borderStrongL:68,accentL:62,accentSat:36},
        signal:{mode:"dark",sat:90,bgL:6,elevL:10,raisedL:14,softL:18,textL:95,mutedL:76,borderL:28,borderStrongL:44,accentL:58,accentSat:98},
        alloy:{mode:"dark",sat:40,bgL:20,elevL:25,raisedL:30,softL:36,textL:93,mutedL:74,borderL:52,borderStrongL:66,accentL:60,accentSat:72}
      });
      Object.assign(stylePresets,{
        neumorph:{
          "--ds-font-sans":"\"Inter\", \"Segoe UI\", Roboto, Arial, sans-serif","--ds-radius-1":"10px","--ds-radius-2":"16px","--ds-radius-3":"22px","--ds-radius-4":"28px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-label-transform":"uppercase","--ds-label-spacing":"0.04em","--ds-card-shadow":"10px 10px 24px rgba(156,169,191,0.5), -9px -9px 22px rgba(255,255,255,0.9)","--ds-btn-shadow":"6px 6px 12px rgba(154,168,193,0.5), -6px -6px 12px rgba(255,255,255,0.86)","--ds-btn-shadow-hover":"8px 8px 14px rgba(154,168,193,0.54), -7px -7px 14px rgba(255,255,255,0.9)","--ds-btn-shadow-active":"inset 4px 4px 8px rgba(157,169,190,0.5), inset -4px -4px 8px rgba(255,255,255,0.82)","--ds-input-shadow":"inset 4px 4px 9px rgba(163,175,198,0.5), inset -4px -4px 9px rgba(255,255,255,0.9)","--ds-body-bg-image":"radial-gradient(circle at 20% 10%, rgba(255,255,255,0.55), transparent 40%)","--ds-card-bg-image":"linear-gradient(150deg, rgba(255,255,255,0.28), rgba(203,214,233,0.22))","--ds-btn-press-transform":"none"
        },
        "eva-wire":{
          "--ds-font-sans":"\"OCR A Std\", \"Eurostile\", \"Bank Gothic\", \"Bahnschrift\", \"Space Mono\", monospace","--ds-radius-1":"0px","--ds-radius-2":"2px","--ds-radius-3":"4px","--ds-radius-4":"6px","--ds-radius-pill":"4px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-label-transform":"uppercase","--ds-label-spacing":"0.18em","--ds-text":"#ff6a1e","--ds-text-muted":"#ff9a4b","--ds-accent":"#ff5a14","--ds-accent-strong":"#ff3d12","--ds-focus":"#ffb86a","--ds-card-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 52%, transparent), 0 0 0 1px color-mix(in oklab,var(--ds-focus) 28%, transparent), 0 0 18px color-mix(in oklab,var(--ds-accent) 24%, transparent)","--ds-btn-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 60%, transparent), 0 0 10px color-mix(in oklab,var(--ds-accent) 26%, transparent)","--ds-btn-shadow-hover":"inset 0 0 0 1px color-mix(in oklab,var(--ds-focus) 56%, transparent), 0 0 16px color-mix(in oklab,var(--ds-accent) 38%, transparent)","--ds-btn-shadow-active":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 72%, transparent)","--ds-input-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 44%, transparent), 0 0 12px color-mix(in oklab,var(--ds-accent) 18%, transparent)","--ds-body-bg-image":"repeating-linear-gradient(0deg, color-mix(in oklab,var(--ds-accent) 12%, transparent) 0 1px, transparent 1px 20px), repeating-linear-gradient(90deg, color-mix(in oklab,var(--ds-accent-strong) 10%, transparent) 0 1px, transparent 1px 16px)","--ds-card-bg-image":"none","--ds-btn-bg":"#141111","--ds-btn-bg-hover":"#1a1312","--ds-input-bg":"#121010","--ds-btn-press-transform":"none"
        },
        "eva-unit01":{
          "--ds-font-sans":"\"OCR A Std\", \"Eurostile\", \"Bank Gothic\", \"Bahnschrift\", \"Space Mono\", monospace","--ds-radius-1":"0px","--ds-radius-2":"2px","--ds-radius-3":"4px","--ds-radius-4":"6px","--ds-radius-pill":"4px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-label-transform":"uppercase","--ds-label-spacing":"0.16em","--ds-bg":"#0b0b0f","--ds-bg-elevated":"#121218","--ds-bg-raised":"#191923","--ds-bg-soft":"#222230","--ds-text":"#f3f0ff","--ds-text-muted":"#ac9dc5","--ds-accent":"#9a58ff","--ds-accent-strong":"#7b3ae0","--ds-focus":"#52f6a9","--ds-success":"#52f6a9","--ds-warning":"#ffad3a","--ds-danger":"#c86df0","--ds-info":"#66b8ff","--ds-card-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 42%, transparent), 0 0 0 1px color-mix(in oklab,var(--ds-focus) 28%, transparent), 0 0 20px color-mix(in oklab,var(--ds-accent) 20%, transparent)","--ds-btn-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 52%, transparent), 0 0 12px color-mix(in oklab,var(--ds-accent) 22%, transparent)","--ds-btn-shadow-hover":"inset 0 0 0 1px color-mix(in oklab,var(--ds-focus) 52%, transparent), 0 0 16px color-mix(in oklab,var(--ds-warning) 28%, transparent)","--ds-btn-shadow-active":"inset 0 0 0 1px color-mix(in oklab,var(--ds-warning) 65%, transparent)","--ds-input-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-focus) 40%, transparent), 0 0 12px color-mix(in oklab,var(--ds-accent) 14%, transparent)","--ds-body-bg-image":"repeating-linear-gradient(0deg, color-mix(in oklab,var(--ds-accent) 11%, transparent) 0 1px, transparent 1px 24px), repeating-linear-gradient(90deg, color-mix(in oklab,var(--ds-focus) 10%, transparent) 0 1px, transparent 1px 18px)","--ds-card-bg-image":"none","--ds-btn-bg":"#1a1826","--ds-btn-bg-hover":"#211d30","--ds-btn-primary-bg":"#965dff","--ds-btn-primary-bg-hover":"#aa79ff","--ds-input-bg":"#17152a","--ds-btn-press-transform":"none"
        },
        "saturn-skeuo":{
          "--ds-font-sans":"\"Trebuchet MS\", \"Segoe UI\", sans-serif","--ds-radius-1":"4px","--ds-radius-2":"10px","--ds-radius-3":"14px","--ds-radius-4":"18px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-label-transform":"uppercase","--ds-label-spacing":"0.1em","--ds-card-shadow":"inset 0 1px 0 rgba(255,255,255,0.62), inset 0 -3px 10px rgba(18,22,30,0.62), 0 16px 28px rgba(5,8,12,0.52)","--ds-btn-shadow":"inset 0 2px 0 rgba(255,255,255,0.9), inset 0 -3px 6px rgba(15,18,26,0.56), 0 4px 10px rgba(8,10,14,0.5)","--ds-btn-shadow-hover":"inset 0 2px 0 rgba(255,255,255,0.96), inset 0 -3px 8px rgba(15,18,26,0.62), 0 6px 14px rgba(8,10,14,0.56)","--ds-btn-shadow-active":"inset 0 4px 10px rgba(19,23,30,0.62), inset 0 -1px 0 rgba(255,255,255,0.3)","--ds-input-bg":"linear-gradient(180deg, #f4e8bd 0%, #d7c993 22%, #887a54 100%)","--ds-input-border":"#c9b57f","--ds-input-text":"#1f2026","--ds-input-placeholder":"#5c5a4d","--ds-input-shadow":"inset 0 2px 4px rgba(21,24,33,0.36), inset 0 1px 0 rgba(255,248,211,0.74)","--ds-body-bg-image":"radial-gradient(circle at 50% -18%, rgba(101,126,168,0.3), transparent 42%), radial-gradient(circle at 50% 120%, rgba(18,28,48,0.7), transparent 54%), linear-gradient(180deg, #0c0f17 0%, #171b28 48%, #0a0b10 100%)","--ds-card-bg-image":"linear-gradient(180deg, rgba(255,255,255,0.24), rgba(26,30,38,0.18))","--ds-btn-press-transform":"translateY(1px)"
        }
      });
      Object.assign(baseThemePresetMap,{
        "velvet-touch":{family:"neumorph",hue:"violet",style:"neumorph",scale:"comfortable"},
        "eva-wireframe":{family:"signal",hue:"signal-red",style:"eva-wire",scale:"compact"},
        "eva-unit-01":{family:"signal",hue:"violet",style:"eva-unit01",scale:"compact"},
        "saturn-alloy":{family:"alloy",hue:"platinum",style:"saturn-skeuo",scale:"standard"}
      });
const familyPresetSelect=document.getElementById("familyPresetSelect"); const huePresetSelect=document.getElementById("huePresetSelect"); const stylePresetSelect=document.getElementById("stylePresetSelect"); const scalePresetSelect=document.getElementById("scalePresetSelect");
function fillPresetSelect(el,dict){Object.keys(dict).forEach((k)=>{const o=document.createElement("option");o.value=k;o.textContent=k;el.appendChild(o);});}
fillPresetSelect(familyPresetSelect,colorFamilyPresets); fillPresetSelect(huePresetSelect,huePresets); fillPresetSelect(stylePresetSelect,stylePresets); fillPresetSelect(scalePresetSelect,scalePresets); familyPresetSelect.value="bold"; huePresetSelect.value="cyan"; stylePresetSelect.value="material"; scalePresetSelect.value="standard";
function hsl(h,s,l){return "hsl("+Math.round(h)+" "+Math.round(s)+"% "+Math.round(l)+"%)";}
function clamp(v,min,max){return Math.min(max,Math.max(min,v));}
function rotate(h,d){return (h+d+360)%360;}
function hueProfile(hueKey){const hue=huePresets[hueKey]||huePresets.cyan;if(typeof hue.h==="number")return {h:hue.h,neutral:false};const map={gray:220,steel:210,slate:230,black:220,white:45};return {h:map[hue.neutral]||200,neutral:true};}
function buildColorBundle(familyKey,hueKey){const fam=colorFamilyPresets[familyKey]||colorFamilyPresets.bold;const hue=hueProfile(hueKey);const h=hue.h;const sat=clamp(hue.neutral?Math.max(6,fam.sat*0.28):fam.sat,4,96);const aSat=clamp(hue.neutral?Math.max(4,fam.accentSat*0.25):fam.accentSat,4,100);const isLight=fam.mode==="light";const textSat=isLight?Math.max(6,sat*0.18):Math.max(8,sat*0.24);const bundle={"--ds-bg":hsl(h,clamp(sat*0.22,5,34),fam.bgL),"--ds-bg-elevated":hsl(h,clamp(sat*0.24,6,36),fam.elevL),"--ds-bg-raised":hsl(h,clamp(sat*0.3,8,40),fam.raisedL),"--ds-bg-soft":hsl(h,clamp(sat*0.36,10,46),fam.softL),"--ds-text":hsl(h,textSat,fam.textL),"--ds-text-muted":hsl(h,clamp(sat*0.2,8,30),fam.mutedL),"--ds-text-inverse":isLight?"#0f1216":"#f6fbff","--ds-border":hsl(h,clamp(sat*0.26,8,36),fam.borderL),"--ds-border-strong":hsl(h,clamp(sat*0.34,12,44),fam.borderStrongL),"--ds-accent":hsl(h,aSat,fam.accentL),"--ds-accent-strong":hsl(h,aSat,clamp(fam.accentL+(isLight?-9:8),6,94)),"--ds-focus":hsl(h,clamp(aSat*0.92,0,100),clamp(fam.accentL+(isLight?-5:16),6,96)),"--ds-success":hsl(rotate(h,118),clamp(aSat*0.74,20,95),clamp(fam.accentL+(isLight?-8:8),8,90)),"--ds-warning":hsl(rotate(h,54),clamp(aSat*0.78,20,95),clamp(fam.accentL+(isLight?-2:10),8,90)),"--ds-danger":hsl(rotate(h,-34),clamp(aSat*0.8,20,95),clamp(fam.accentL+(isLight?-1:10),8,90)),"--ds-info":hsl(rotate(h,18),clamp(aSat*0.72,20,95),clamp(fam.accentL+(isLight?-4:9),8,90)),"--ds-btn-primary-bg":hsl(h,aSat,fam.accentL),"--ds-btn-primary-bg-hover":hsl(h,aSat,clamp(fam.accentL+(isLight?-7:7),6,95)),"--ds-btn-primary-border":hsl(h,clamp(aSat*0.9,0,100),clamp(fam.accentL+(isLight?-13:2),6,95)),"--ds-btn-primary-text":isLight?"#ffffff":"#071018","--ds-bg-overlay":isLight?"rgba(24,26,30,0.15)":"rgba(5,9,15,0.72)","--ds-body-bg-image":"none","--ds-card-bg-image":"none"};if(familyKey==="cathode"||familyKey==="electric"){bundle["--ds-body-bg-image"]="radial-gradient(circle at 20% 8%, color-mix(in oklab, var(--ds-accent) 26%, transparent), transparent 45%), repeating-linear-gradient(0deg, rgba(255,255,255,0.012) 0px, rgba(255,255,255,0.012) 2px, transparent 2px, transparent 6px)";bundle["--ds-card-bg-image"]="linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.05))";}if(familyKey==="electric"){bundle["--ds-bg-overlay"]="rgba(2,7,14,0.8)";bundle["--ds-focus"]=hsl(h,100,82);}if(familyKey==="sunset"){bundle["--ds-bg-overlay"]="rgba(20,7,3,0.75)";}if(familyKey==="frost"){bundle["--ds-bg-overlay"]="rgba(24,38,58,0.18)";}if(familyKey==="neumorph"){bundle["--ds-bg-overlay"]="rgba(73,84,104,0.24)";bundle["--ds-body-bg-image"]="radial-gradient(circle at 20% 10%, rgba(255,255,255,0.55), transparent 40%)";bundle["--ds-card-bg-image"]="linear-gradient(150deg, rgba(255,255,255,0.28), rgba(203,214,233,0.22))";}if(familyKey==="signal"){bundle["--ds-bg-overlay"]="rgba(2,3,6,0.84)";bundle["--ds-body-bg-image"]="repeating-linear-gradient(0deg, color-mix(in oklab,var(--ds-focus) 14%, transparent) 0 1px, transparent 1px 22px), repeating-linear-gradient(90deg, color-mix(in oklab,var(--ds-accent) 10%, transparent) 0 1px, transparent 1px 18px)";bundle["--ds-card-bg-image"]="none";}if(familyKey==="alloy"){bundle["--ds-bg-overlay"]="rgba(9,10,14,0.66)";bundle["--ds-body-bg-image"]="linear-gradient(150deg, rgba(255,255,255,0.08), transparent 30%), repeating-linear-gradient(110deg, rgba(255,255,255,0.035) 0 2px, rgba(0,0,0,0.02) 2px 4px)";bundle["--ds-card-bg-image"]="linear-gradient(180deg, rgba(255,255,255,0.18), rgba(26,30,38,0.14))";}if(familyKey==="paper"||familyKey==="pastel"||familyKey==="frost"||familyKey==="neumorph"){bundle["--ds-btn-primary-text"]="#ffffff";}if(familyKey==="monochrome"||familyKey==="noir"){bundle["--ds-success"]=bundle["--ds-accent"];bundle["--ds-warning"]=bundle["--ds-accent-strong"];bundle["--ds-danger"]=bundle["--ds-accent"];bundle["--ds-info"]=bundle["--ds-accent-strong"];}return bundle;}
const savedTheme=localStorage.getItem(storageKey); const initialTheme=savedTheme||root.getAttribute("data-theme")||"steel-night"; root.setAttribute("data-theme",initialTheme); themeSelect.value=initialTheme;
      function normalizeHex(v){const raw=(v||"").trim();if(!/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(raw))return null;if(raw.length===4)return "#"+raw[1]+raw[1]+raw[2]+raw[2]+raw[3]+raw[3];return raw.toLowerCase();}
      function toHex(v){const direct=normalizeHex(v);if(direct)return direct;const probe=document.createElement("span");probe.style.color="";probe.style.color=(v||"").trim();if(!probe.style.color)return null;probe.style.position="fixed";probe.style.left="-9999px";probe.style.top="-9999px";document.body.appendChild(probe);const resolved=getComputedStyle(probe).color;probe.remove();const m=resolved.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)/i);if(!m)return null;return "#"+[m[1],m[2],m[3]].map((n)=>Number(n).toString(16).padStart(2,"0")).join("");}
      function splitTopLevelComma(v){const out=[];let depth=0;let start=0;for(let i=0;i<v.length;i+=1){const ch=v[i];if(ch==="(")depth+=1;else if(ch===")")depth=Math.max(0,depth-1);else if(ch===","&&depth===0){out.push(v.slice(start,i).trim());start=i+1;}}out.push(v.slice(start).trim());return out.filter(Boolean);}
      function parseShadow(raw){if(!raw||raw==="none")return null;const first=splitTopLevelComma(raw)[0]||raw;const inset=/\binset\b/i.test(first);const noInset=first.replace(/\binset\b/ig," ").replace(/\s+/g," ").trim();const m=noInset.match(/^(-?\d+(?:\.\d+)?)px\s+(-?\d+(?:\.\d+)?)px\s+(-?\d+(?:\.\d+)?)px(?:\s+(-?\d+(?:\.\d+)?)px)?\s+(.+)$/i);if(!m)return null;return {x:parseFloat(m[1])||0,y:parseFloat(m[2])||0,blur:parseFloat(m[3])||0,spread:parseFloat(m[4]||"0")||0,color:toHex(m[5].trim())||"#000000",inset};}
      function buildShadow(meta){const x=Number(meta.x.value)||0;const y=Number(meta.y.value)||0;const blur=Math.max(0,Number(meta.blur.value)||0);const spread=Number(meta.spread.value)||0;const color=normalizeHex(meta.color.value)||meta.color.value||"#000000";return (meta.inset.checked?"inset ":"")+x+"px "+y+"px "+blur+"px "+spread+"px "+color;}
      const shadowPresets={flat:{x:0,y:0,blur:0,spread:0,color:"#000000",inset:false},soft:{x:0,y:4,blur:14,spread:0,color:"#000000",inset:false},hard:{x:0,y:2,blur:0,spread:0,color:"#000000",inset:false},glow:{x:0,y:0,blur:16,spread:0,color:"#66ccff",inset:false},inset:{x:0,y:1,blur:3,spread:0,color:"#000000",inset:true}};
      function applyShadowPreset(meta,key){const p=shadowPresets[key];if(!p)return;meta.x.value=p.x;meta.y.value=p.y;meta.blur.value=p.blur;meta.spread.value=p.spread;meta.color.value=p.color;meta.inset.checked=p.inset;applyControl(meta);}
      function parseRgba(raw){const m=(raw||"").trim().match(/^rgba?\(\s*(\d{1,3})[\s,]+(\d{1,3})[\s,]+(\d{1,3})(?:[\s,\/]+([0-9]*\.?[0-9]+))?\s*\)$/i);if(m)return {r:Math.min(255,Math.max(0,Number(m[1])||0)),g:Math.min(255,Math.max(0,Number(m[2])||0)),b:Math.min(255,Math.max(0,Number(m[3])||0)),a:Math.min(1,Math.max(0,m[4]!==undefined?Number(m[4]):1))};const hex=toHex(raw);if(!hex)return null;return {r:parseInt(hex.slice(1,3),16),g:parseInt(hex.slice(3,5),16),b:parseInt(hex.slice(5,7),16),a:1};}
      function buildRgba(meta){const r=Math.min(255,Math.max(0,Number(meta.r.value)||0));const g=Math.min(255,Math.max(0,Number(meta.g.value)||0));const b=Math.min(255,Math.max(0,Number(meta.b.value)||0));const a=Math.min(1,Math.max(0,Number(meta.a.value)||0));return "rgba("+r+", "+g+", "+b+", "+a.toFixed(2)+")";}
      function parsePaint(raw){const v=(raw||"").trim();const grad=v.match(/^linear-gradient\(\s*([\-0-9.]+)deg\s*,\s*(.+?)\s*,\s*(.+?)\s*\)$/i);if(grad){return {mode:"gradient",angle:parseFloat(grad[1])||180,c1:toHex(grad[2].trim())||"#666666",c2:toHex(grad[3].trim())||"#333333"};}const hex=toHex(v);if(hex)return {mode:"solid",angle:180,c1:hex,c2:hex};return {mode:"solid",angle:180,c1:"#555555",c2:"#222222"};}
      function buildPaint(meta){const mode=meta.mode.value;if(mode==="gradient"){const ang=Number(meta.angle.value)||180;const c1=normalizeHex(meta.c1.value)||"#666666";const c2=normalizeHex(meta.c2.value)||"#333333";return "linear-gradient("+ang+"deg, "+c1+", "+c2+")";}return normalizeHex(meta.c1.value)||meta.c1.value||"#555555";}
      function parseTranslateY(raw){const m=(raw||"").trim().match(/^translateY\(\s*(-?\d+(?:\.\d+)?)px\s*\)$/i);return m?parseFloat(m[1])||0:0;}
      function buildTranslateY(meta){const y=Number(meta.y.value)||0;return "translateY("+y+"px)";}
      function parseBezier(raw){const m=(raw||"").trim().match(/^cubic-bezier\(\s*(-?\d*\.?\d+)\s*,\s*(-?\d*\.?\d+)\s*,\s*(-?\d*\.?\d+)\s*,\s*(-?\d*\.?\d+)\s*\)$/i);if(!m)return null;return {x1:parseFloat(m[1]),y1:parseFloat(m[2]),x2:parseFloat(m[3]),y2:parseFloat(m[4])};}
      function buildBezier(meta){return "cubic-bezier("+Number(meta.x1.value)+", "+Number(meta.y1.value)+", "+Number(meta.x2.value)+", "+Number(meta.y2.value)+")";}
      function parseLength(v,f){const n=parseFloat(v);return Number.isFinite(n)?n:f;}
      function humanLabel(t){return t.replace("--ds-","").replace(/-/g," ");}
      function clearOverrides(){root.removeAttribute("style");}
      function setTokenBundle(b){Object.keys(b).forEach((t)=>root.style.setProperty(t,b[t]));}
      function setPresetSelectors(combo){if(!combo)return;familyPresetSelect.value=combo.family;huePresetSelect.value=combo.hue;stylePresetSelect.value=combo.style;scalePresetSelect.value=combo.scale;}
      function applySelectedPresetCombo(){root.removeAttribute("data-theme");setTokenBundle(buildColorBundle(familyPresetSelect.value,huePresetSelect.value));setTokenBundle(stylePresets[stylePresetSelect.value]);setTokenBundle(scalePresets[scalePresetSelect.value]);}
      function syncControlsFromComputed(){const cs=getComputedStyle(root);controlMap.forEach((meta,token)=>{const raw=cs.getPropertyValue(token).trim();if(meta.type==="color"){const hex=toHex(raw);if(hex){meta.main.value=hex;meta.extra.value=hex;}else{meta.extra.value=raw;}}else if(meta.type==="shadow"){const sh=parseShadow(raw);if(sh){meta.x.value=sh.x;meta.y.value=sh.y;meta.blur.value=sh.blur;meta.spread.value=sh.spread;meta.color.value=sh.color;meta.inset.checked=sh.inset;}else{meta.x.value=0;meta.y.value=2;meta.blur.value=8;meta.spread.value=0;meta.color.value="#000000";meta.inset.checked=false;}}else if(meta.type==="rgba"){const rgba=parseRgba(raw)||{r:0,g:0,b:0,a:0.6};meta.r.value=rgba.r;meta.g.value=rgba.g;meta.b.value=rgba.b;meta.a.value=rgba.a;}else if(meta.type==="paint"){const paint=parsePaint(raw);meta.mode.value=paint.mode;meta.angle.value=paint.angle;meta.c1.value=paint.c1;meta.c2.value=paint.c2;meta.angle.disabled=paint.mode!=="gradient";meta.c2.disabled=paint.mode!=="gradient";}else if(meta.type==="translateY"){meta.y.value=parseTranslateY(raw);}else if(meta.type==="bezier"){const b=parseBezier(raw)||{x1:0.2,y1:0,x2:0,y2:1};meta.x1.value=b.x1;meta.y1.value=b.y1;meta.x2.value=b.x2;meta.y2.value=b.y2;}else if(meta.type==="length")meta.main.value=parseLength(raw,0);else if(meta.type==="number")meta.main.value=parseFloat(raw)||0;else meta.main.value=raw;});}
      function applyControl(meta,source){let value="";if(meta.type==="color"){if(source==="picker"){value=normalizeHex(meta.main.value)||meta.main.value;meta.extra.value=value;}else{const normalized=toHex(meta.extra.value);if(!normalized)return;value=normalized;meta.main.value=normalized;meta.extra.value=normalized;}}else if(meta.type==="shadow"){value=buildShadow(meta);}else if(meta.type==="rgba"){value=buildRgba(meta);}else if(meta.type==="paint"){value=buildPaint(meta);meta.angle.disabled=meta.mode.value!=="gradient";meta.c2.disabled=meta.mode.value!=="gradient";}else if(meta.type==="translateY"){value=buildTranslateY(meta);}else if(meta.type==="bezier"){value=buildBezier(meta);}else if(meta.type==="length"){value=String(meta.main.value)+meta.unit;}else value=meta.main.value;root.style.setProperty(meta.token,value);}
      function renderBuilder(){const host=document.getElementById("builderGroups");tokenGroups.forEach((group)=>{const card=document.createElement("article");card.className="ds-card builder-group";const title=document.createElement("h3");title.className="ds-card-title";title.textContent=group.name;card.appendChild(title);group.controls.forEach((control)=>{const field=document.createElement("div");field.className="builder-field";const label=document.createElement("label");label.textContent=humanLabel(control.token);field.appendChild(label);let main;let extra;let meta;if(control.type==="color"){const row=document.createElement("div");row.className="builder-field-row";main=document.createElement("input");main.type="color";main.className="builder-color";extra=document.createElement("input");extra.type="text";extra.className="ds-input";row.appendChild(main);row.appendChild(extra);field.appendChild(row);meta={token:control.token,type:control.type,unit:control.unit||"",main,extra};main.addEventListener("input",()=>applyControl(meta,"picker"));extra.addEventListener("input",()=>applyControl(meta,"text"));}else if(control.type==="shadow"){const grid=document.createElement("div");grid.className="builder-shadow-grid";const x=document.createElement("input");x.className="ds-input";x.type="number";x.step="1";const y=document.createElement("input");y.className="ds-input";y.type="number";y.step="1";const blur=document.createElement("input");blur.className="ds-input";blur.type="number";blur.step="1";const spread=document.createElement("input");spread.className="ds-input";spread.type="number";spread.step="1";x.placeholder="x";y.placeholder="y";blur.placeholder="blur";spread.placeholder="spread";grid.appendChild(x);grid.appendChild(y);grid.appendChild(blur);grid.appendChild(spread);field.appendChild(grid);const compact=document.createElement("div");compact.className="builder-shadow-grid compact";const color=document.createElement("input");color.type="color";color.className="builder-color";const insetWrap=document.createElement("label");insetWrap.className="builder-shadow-flag";const inset=document.createElement("input");inset.type="checkbox";insetWrap.appendChild(inset);insetWrap.appendChild(document.createTextNode("Inset"));compact.appendChild(color);compact.appendChild(insetWrap);field.appendChild(compact);const presets=document.createElement("div");presets.className="builder-preset-row";[["flat","Flat"],["soft","Soft"],["hard","Hard"],["glow","Glow"],["inset","Inset"]].forEach((pair)=>{const btn=document.createElement("button");btn.type="button";btn.className="ds-btn";btn.textContent=pair[1];btn.addEventListener("click",()=>applyShadowPreset(meta,pair[0]));presets.appendChild(btn);});field.appendChild(presets);meta={token:control.token,type:"shadow",x,y,blur,spread,color,inset};[x,y,blur,spread,color,inset].forEach((el)=>el.addEventListener("input",()=>applyControl(meta)));}else if(control.type==="rgba"){const grid=document.createElement("div");grid.className="builder-multi-grid";const r=document.createElement("input");r.className="ds-input";r.type="number";r.min="0";r.max="255";r.step="1";r.placeholder="R";const g=document.createElement("input");g.className="ds-input";g.type="number";g.min="0";g.max="255";g.step="1";g.placeholder="G";const b=document.createElement("input");b.className="ds-input";b.type="number";b.min="0";b.max="255";b.step="1";b.placeholder="B";const a=document.createElement("input");a.className="ds-input";a.type="number";a.min="0";a.max="1";a.step="0.01";a.placeholder="A";grid.appendChild(r);grid.appendChild(g);grid.appendChild(b);grid.appendChild(a);field.appendChild(grid);meta={token:control.token,type:"rgba",r,g,b,a};[r,g,b,a].forEach((el)=>el.addEventListener("input",()=>applyControl(meta)));}else if(control.type==="paint"){const row=document.createElement("div");row.className="builder-field-row single";const mode=document.createElement("select");mode.className="ds-select";[["solid","Solid"],["gradient","Linear"]].forEach((pair)=>{const opt=document.createElement("option");opt.value=pair[0];opt.textContent=pair[1];mode.appendChild(opt);});row.appendChild(mode);field.appendChild(row);const grid=document.createElement("div");grid.className="builder-multi-grid";const angle=document.createElement("input");angle.className="ds-input";angle.type="number";angle.step="1";angle.placeholder="angle";const c1=document.createElement("input");c1.type="color";c1.className="builder-color";const c2=document.createElement("input");c2.type="color";c2.className="builder-color";const pad=document.createElement("div");grid.appendChild(angle);grid.appendChild(c1);grid.appendChild(c2);grid.appendChild(pad);field.appendChild(grid);meta={token:control.token,type:"paint",mode,angle,c1,c2};[mode,angle,c1,c2].forEach((el)=>el.addEventListener("input",()=>applyControl(meta)));}else if(control.type==="translateY"){const row=document.createElement("div");row.className="builder-field-row single";const y=document.createElement("input");y.className="ds-input";y.type="number";y.step="0.5";row.appendChild(y);field.appendChild(row);meta={token:control.token,type:"translateY",y};y.addEventListener("input",()=>applyControl(meta));}else if(control.type==="bezier"){const grid=document.createElement("div");grid.className="builder-multi-grid";const x1=document.createElement("input");x1.className="ds-input";x1.type="number";x1.step="0.01";const y1=document.createElement("input");y1.className="ds-input";y1.type="number";y1.step="0.01";const x2=document.createElement("input");x2.className="ds-input";x2.type="number";x2.step="0.01";const y2=document.createElement("input");y2.className="ds-input";y2.type="number";y2.step="0.01";x1.placeholder="x1";y1.placeholder="y1";x2.placeholder="x2";y2.placeholder="y2";grid.appendChild(x1);grid.appendChild(y1);grid.appendChild(x2);grid.appendChild(y2);field.appendChild(grid);const presets=document.createElement("div");presets.className="builder-preset-row";[["standard",[0.2,0,0,1]],["easeOut",[0,0,0.2,1]],["linear",[0,0,1,1]],["snappy",[0.22,1,0.36,1]]].forEach((pair)=>{const btn=document.createElement("button");btn.type="button";btn.className="ds-btn";btn.textContent=pair[0];btn.addEventListener("click",()=>{x1.value=pair[1][0];y1.value=pair[1][1];x2.value=pair[1][2];y2.value=pair[1][3];applyControl(meta);});presets.appendChild(btn);});field.appendChild(presets);meta={token:control.token,type:"bezier",x1,y1,x2,y2};[x1,y1,x2,y2].forEach((el)=>el.addEventListener("input",()=>applyControl(meta)));}else if(control.type==="select"){const row=document.createElement("div");row.className="builder-field-row single";main=document.createElement("select");main.className="ds-select";control.options.forEach((opt)=>{const option=document.createElement("option");option.value=opt;option.textContent=opt;main.appendChild(option);});row.appendChild(main);field.appendChild(row);meta={token:control.token,type:control.type,unit:control.unit||"",main,extra};main.addEventListener("input",()=>applyControl(meta));}else{const row=document.createElement("div");row.className="builder-field-row single";main=document.createElement("input");main.className="ds-input";if(control.type==="length"||control.type==="number"){main.type="number";if(control.step)main.step=control.step;}else main.type="text";row.appendChild(main);field.appendChild(row);meta={token:control.token,type:control.type,unit:control.unit||"",main,extra};main.addEventListener("input",()=>applyControl(meta));}controlMap.set(control.token,meta);card.appendChild(field);});host.appendChild(card);});}
      function getRawTokenValue(meta){if(!meta)return "";if(meta.type==="color")return meta.extra.value.trim();if(meta.type==="shadow")return buildShadow(meta);if(meta.type==="rgba")return buildRgba(meta);if(meta.type==="paint")return buildPaint(meta);if(meta.type==="translateY")return buildTranslateY(meta);if(meta.type==="bezier")return buildBezier(meta);if(meta.type==="length")return String(meta.main.value).trim()+meta.unit;return String(meta.main.value).trim();}
      function tokenUsageHint(token){if(token.indexOf("--ds-bg")===0||token.indexOf("--ds-text")===0||token.indexOf("--ds-border")===0||token.indexOf("--ds-accent")===0)return "Semantic token used by many components for visual language.";if(token.indexOf("--ds-space")===0||token.indexOf("--ds-layout")===0||token.indexOf("--ds-card-pad")===0||token.indexOf("--ds-control-h")===0)return "Layout token for spacing, density, and component sizing.";if(token.indexOf("--ds-font")===0||token.indexOf("--ds-fs")===0||token.indexOf("--ds-lh")===0||token.indexOf("--ds-label")===0)return "Typography token for font family, scale, and readability.";if(token.indexOf("--ds-shadow")===0)return "Depth token for elevation and layering effects.";if(token.indexOf("--ds-btn")===0||token.indexOf("--ds-input")===0||token.indexOf("--ds-card")===0||token.indexOf("--ds-chip")===0||token.indexOf("--ds-table")===0||token.indexOf("--ds-modal")===0||token.indexOf("--ds-toast")===0)return "Component token mapped directly to a specific UI element.";return "Foundation token shared across this design system.";}
      function copyTextValue(text){if(!text)return Promise.resolve(false);if(navigator.clipboard&&navigator.clipboard.writeText)return navigator.clipboard.writeText(text).then(()=>true).catch(()=>false);const probe=document.createElement("textarea");probe.value=text;probe.setAttribute("readonly","readonly");probe.style.position="fixed";probe.style.left="-9999px";probe.style.top="-9999px";document.body.appendChild(probe);probe.select();const ok=document.execCommand("copy");probe.remove();return Promise.resolve(!!ok);}
      function openTokenInfo(token){const dialog=document.getElementById("tokenInfoDialog");const meta=controlMap.get(token);if(!dialog||!meta)return;const assignment=token+": "+getRawTokenValue(meta)+";";document.getElementById("tokenInfoTitle").textContent=humanLabel(token);document.getElementById("tokenInfoHint").textContent="This setting writes a design token variable used across components.";document.getElementById("tokenInfoToken").textContent=token;document.getElementById("tokenInfoAssignment").textContent=assignment;document.getElementById("tokenInfoUsage").textContent=tokenUsageHint(token);document.getElementById("copyTokenInfoBtn").onclick=function(){copyTextValue(assignment).then((ok)=>{if(ok)addToast("success","Copied token assignment.");else addToast("danger","Copy failed.");});};dialog.showModal();}
      function attachBuilderLearningTools(){const tokenList=[];tokenGroups.forEach((group)=>group.controls.forEach((control)=>tokenList.push(control.token)));const fields=document.querySelectorAll("#builderGroups .builder-field");fields.forEach((field,index)=>{if(field.dataset.enhanced==="1")return;const token=tokenList[index]||"";const label=field.querySelector("label");if(!token||!label)return;field.dataset.token=token;const head=document.createElement("div");head.className="builder-field-head";label.parentNode.insertBefore(head,label);head.appendChild(label);const actions=document.createElement("div");actions.className="builder-field-actions";const infoBtn=document.createElement("button");infoBtn.type="button";infoBtn.className="ds-btn builder-help-btn";infoBtn.textContent="i";infoBtn.title="Show token details";infoBtn.setAttribute("aria-label","Show token details");infoBtn.addEventListener("click",()=>openTokenInfo(token));const copyBtn=document.createElement("button");copyBtn.type="button";copyBtn.className="ds-btn builder-help-btn";copyBtn.textContent="Copy";copyBtn.title="Copy token assignment";copyBtn.setAttribute("aria-label","Copy token assignment");copyBtn.addEventListener("click",()=>{const meta=controlMap.get(token);if(!meta)return;const text=token+": "+getRawTokenValue(meta)+";";copyTextValue(text).then((ok)=>{if(ok)addToast("success","Copied "+token);else addToast("danger","Copy failed.");});});actions.appendChild(infoBtn);actions.appendChild(copyBtn);head.appendChild(actions);field.dataset.enhanced="1";});}
      renderBuilder();
      attachBuilderLearningTools();
      const initialCombo=baseThemePresetMap[initialTheme];
      if(initialCombo){setPresetSelectors(initialCombo);clearOverrides();applySelectedPresetCombo();}
      syncControlsFromComputed();
      function sanitizeThemeName(raw){return (raw||"custom-theme").trim().replace(/[^a-z0-9\-_]/gi,"-").toLowerCase()||"custom-theme";}
      function buildThemeBlock(themeName){const lines=[":root[data-theme=\""+themeName+"\"] {"];controlMap.forEach((meta,token)=>{let value="";if(meta.type==="color")value=meta.extra.value.trim();else if(meta.type==="shadow")value=buildShadow(meta);else if(meta.type==="rgba")value=buildRgba(meta);else if(meta.type==="paint")value=buildPaint(meta);else if(meta.type==="translateY")value=buildTranslateY(meta);else if(meta.type==="bezier")value=buildBezier(meta);else if(meta.type==="length")value=String(meta.main.value).trim()+meta.unit;else value=String(meta.main.value).trim();lines.push("  "+token+": "+value+";");});lines.push("}");return lines.join("\n");}
      function exportThemeBlock(){const name=sanitizeThemeName(document.getElementById("themeNameInput").value);const block=buildThemeBlock(name);document.getElementById("themeExportOutput").value=block;return { name, block };}
      function performReset(){clearOverrides();const combo=baseThemePresetMap[themeSelect.value];if(combo)setPresetSelectors(combo);applySelectedPresetCombo();syncControlsFromComputed();}
      function downloadBlob(filename,blob){const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=filename;document.body.appendChild(a);a.click();a.remove();setTimeout(()=>URL.revokeObjectURL(url),1500);}
      function crc32(bytes){let c=0^(-1);for(let i=0;i<bytes.length;i++){c=(c>>>8)^crcTable[(c^bytes[i])&255];}return (c^(-1))>>>0;}
      const crcTable=(()=>{const t=new Uint32Array(256);for(let n=0;n<256;n++){let c=n;for(let k=0;k<8;k++)c=((c&1)?(0xEDB88320^(c>>>1)):(c>>>1));t[n]=c>>>0;}return t;})();
      function makeZip(files){const enc=new TextEncoder();const localParts=[];const centralParts=[];let offset=0;const now=new Date();const dosTime=((now.getHours()&31)<<11)|((now.getMinutes()&63)<<5)|((Math.floor(now.getSeconds()/2))&31);const dosDate=(((now.getFullYear()-1980)&127)<<9)|(((now.getMonth()+1)&15)<<5)|(now.getDate()&31);files.forEach((f)=>{const nameBytes=enc.encode(f.name);const dataBytes=enc.encode(f.content);const crc=crc32(dataBytes);const lh=new Uint8Array(30);const lhv=new DataView(lh.buffer);lhv.setUint32(0,0x04034b50,true);lhv.setUint16(4,20,true);lhv.setUint16(6,0,true);lhv.setUint16(8,0,true);lhv.setUint16(10,dosTime,true);lhv.setUint16(12,dosDate,true);lhv.setUint32(14,crc,true);lhv.setUint32(18,dataBytes.length,true);lhv.setUint32(22,dataBytes.length,true);lhv.setUint16(26,nameBytes.length,true);lhv.setUint16(28,0,true);localParts.push(lh,nameBytes,dataBytes);const ch=new Uint8Array(46);const chv=new DataView(ch.buffer);chv.setUint32(0,0x02014b50,true);chv.setUint16(4,20,true);chv.setUint16(6,20,true);chv.setUint16(8,0,true);chv.setUint16(10,0,true);chv.setUint16(12,dosTime,true);chv.setUint16(14,dosDate,true);chv.setUint32(16,crc,true);chv.setUint32(20,dataBytes.length,true);chv.setUint32(24,dataBytes.length,true);chv.setUint16(28,nameBytes.length,true);chv.setUint16(30,0,true);chv.setUint16(32,0,true);chv.setUint16(34,0,true);chv.setUint16(36,0,true);chv.setUint32(38,0,true);chv.setUint32(42,offset,true);centralParts.push(ch,nameBytes);offset+=lh.length+nameBytes.length+dataBytes.length;});let centralSize=0;centralParts.forEach((p)=>{centralSize+=p.length;});const end=new Uint8Array(22);const ev=new DataView(end.buffer);ev.setUint32(0,0x06054b50,true);ev.setUint16(4,0,true);ev.setUint16(6,0,true);ev.setUint16(8,files.length,true);ev.setUint16(10,files.length,true);ev.setUint32(12,centralSize,true);ev.setUint32(16,offset,true);ev.setUint16(20,0,true);return new Blob([...localParts,...centralParts,end],{type:"application/zip"});}
      function buildPackageFiles(themeName,themeBlock){const recipe={themeName:themeName,baseTheme:themeSelect.value,colorFamily:familyPresetSelect.value,hue:huePresetSelect.value,style:stylePresetSelect.value,scale:scalePresetSelect.value,generatedAt:new Date().toISOString()};return[{name:"README.md",content:"# "+themeName+" theme package\n\nThis package was exported from Design System Studio.\nUse INSTALL.md for setup steps.\n"},{name:"INSTALL.md",content:"1. Copy `"+themeName+".css` into your project styles folder.\n2. Append the block into your theme file (or import it).\n3. Set `<html data-theme=\\\""+themeName+"\\\">` in your page.\n4. Ensure your app includes `_DesignSystem/theme.css` (or equivalent token+component files).\n"},{name:themeName+".css",content:themeBlock+"\n"},{name:"theme.recipe.json",content:JSON.stringify(recipe,null,2)}];}
      document.getElementById("applyPresetBtn").addEventListener("click",function(){clearOverrides();applySelectedPresetCombo();syncControlsFromComputed();});
      themeSelect.addEventListener("change",function(){const theme=themeSelect.value;root.setAttribute("data-theme",theme);localStorage.setItem(storageKey,theme);clearOverrides();const combo=baseThemePresetMap[theme];if(combo){setPresetSelectors(combo);applySelectedPresetCombo();}syncControlsFromComputed();});
      const resetDialog=document.getElementById("resetConfirmDialog"); const skipResetConfirmChk=document.getElementById("skipResetConfirmChk"); document.getElementById("resetOverridesBtn").addEventListener("click",function(){if(localStorage.getItem(resetConfirmKey)==="1"){performReset();return;}skipResetConfirmChk.checked=false;resetDialog.showModal();}); document.getElementById("cancelResetBtn").addEventListener("click",function(){resetDialog.close();}); document.getElementById("confirmResetBtn").addEventListener("click",function(){if(skipResetConfirmChk.checked)localStorage.setItem(resetConfirmKey,"1");resetDialog.close();performReset();});
      document.getElementById("exportThemeBtn").addEventListener("click",function(){exportThemeBlock();});
      document.getElementById("copyExportBtn").addEventListener("click",async function(){const out=document.getElementById("themeExportOutput");if(!out.value.trim())exportThemeBlock();if(!out.value.trim())return;try{await navigator.clipboard.writeText(out.value);}catch(_){out.select();document.execCommand("copy");}});
      document.getElementById("downloadPackageBtn").addEventListener("click",function(){const exp=exportThemeBlock();const files=buildPackageFiles(exp.name,exp.block);const zip=makeZip(files);downloadBlob(exp.name+"-theme-package.zip",zip);});
      document.querySelectorAll(".studio-tab").forEach((btn)=>btn.addEventListener("click",function(){const panel=btn.getAttribute("data-panel");document.querySelectorAll(".studio-tab").forEach((b)=>b.setAttribute("aria-selected","false"));document.querySelectorAll(".studio-panel").forEach((p)=>p.hidden=true);btn.setAttribute("aria-selected","true");document.getElementById("panel-"+panel).hidden=false;}));
      const dropdown=document.getElementById("actionsDropdown"); const dropdownToggle=document.getElementById("dropdownToggle"); dropdownToggle.addEventListener("click",function(){const open=dropdown.classList.toggle("is-open");dropdownToggle.setAttribute("aria-expanded",String(open));});
      const popover=document.getElementById("helpPopover");
      const popoverToggle=document.getElementById("popoverToggle");
      function positionPopover(){
        const panel=popover.querySelector(".ds-popover");
        if(!panel)return;
        const gap=8;
        const vw=window.innerWidth;
        const vh=window.innerHeight;
        const triggerRect=popoverToggle.getBoundingClientRect();
        const panelRect=panel.getBoundingClientRect();
        const panelW=panelRect.width||260;
        const panelH=panelRect.height||120;
        const placeTop=(vh-triggerRect.bottom-gap<panelH)&&(triggerRect.top-gap>vh-triggerRect.bottom-gap);
        const targetTop=placeTop?(triggerRect.top-panelH-gap):(triggerRect.bottom+gap);
        let targetLeft=triggerRect.left;
        if(targetLeft+panelW>vw-gap)targetLeft=vw-gap-panelW;
        if(targetLeft<gap)targetLeft=gap;
        if(targetTop<gap){
          panel.style.top=gap+"px";
        }else if(targetTop+panelH>vh-gap){
          panel.style.top=Math.max(gap,vh-gap-panelH)+"px";
        }else{
          panel.style.top=targetTop+"px";
        }
        panel.style.left=targetLeft+"px";
      }
      function closePopover(){popover.classList.remove("is-open");popoverToggle.setAttribute("aria-expanded","false");}
      popoverToggle.addEventListener("click",function(){
        const open=popover.classList.toggle("is-open");
        popoverToggle.setAttribute("aria-expanded",String(open));
        if(open)positionPopover();
      });
      window.addEventListener("resize",function(){if(popover.classList.contains("is-open"))positionPopover();});
      window.addEventListener("scroll",function(){if(popover.classList.contains("is-open"))positionPopover();},{passive:true});
      document.addEventListener("click",function(event){if(!dropdown.contains(event.target)){dropdown.classList.remove("is-open");dropdownToggle.setAttribute("aria-expanded","false");}if(!popover.contains(event.target))closePopover();});
      const modal=document.getElementById("modal"); const drawer=document.getElementById("drawer"); document.getElementById("openModalBtn").addEventListener("click",function(){modal.showModal();}); document.getElementById("closeModalBtn").addEventListener("click",function(){modal.close();}); document.getElementById("confirmModalBtn").addEventListener("click",function(){modal.close();}); document.getElementById("openDrawerBtn").addEventListener("click",function(){drawer.showModal();}); document.getElementById("closeDrawerBtn").addEventListener("click",function(){drawer.close();});
      const tokenInfoDialog=document.getElementById("tokenInfoDialog"); document.getElementById("closeTokenInfoBtn").addEventListener("click",function(){tokenInfoDialog.close();});
      function addToast(kind,text){const stack=document.getElementById("toastStack");const node=document.createElement("div");node.className="ds-toast "+kind;node.textContent=text;stack.appendChild(node);setTimeout(function(){node.remove();},2600);} document.getElementById("toastSuccessBtn").addEventListener("click",function(){addToast("success","Saved successfully.");}); document.getElementById("toastErrorBtn").addEventListener("click",function(){addToast("danger","Action failed. Please retry.");});
      const sliderDemo=document.getElementById("sliderDemo"); const sliderDemoValue=document.getElementById("sliderDemoValue"); sliderDemo.addEventListener("input",function(){sliderDemoValue.textContent=sliderDemo.value;});
      const segDemo=document.getElementById("segDemo"); segDemo.querySelectorAll("button").forEach((b)=>b.addEventListener("click",function(){segDemo.querySelectorAll("button").forEach((x)=>x.setAttribute("aria-pressed","false"));b.setAttribute("aria-pressed","true");}));
      let arrowValue=0; const arrowOut=document.getElementById("arrowValue"); document.getElementById("arrowUpBtn").addEventListener("click",function(){arrowValue+=1;arrowOut.textContent=String(arrowValue);}); document.getElementById("arrowDownBtn").addEventListener("click",function(){arrowValue-=1;arrowOut.textContent=String(arrowValue);});
    })();
  </script>
</body>
</html>




