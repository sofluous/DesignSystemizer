<!doctype html>
<html lang="en" data-theme="steel-night">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design System Studio</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./theme.css">
  <style>
    .studio{display:grid;grid-template-columns:300px 1fr;min-height:100vh;background:var(--ds-bg)}
    .studio-sidebar{position:sticky;top:0;height:100vh;overflow:auto;border-right:var(--ds-border-w) var(--ds-border-style) var(--ds-border);background:var(--ds-bg-elevated);padding:var(--ds-space-4);display:grid;gap:var(--ds-space-4);align-content:start}
    .studio-brand h1{margin:0;font-size:var(--ds-fs-3)}
    .studio-brand p{margin:4px 0 0;color:var(--ds-text-muted);font-size:var(--ds-fs-1)}
    .studio-nav{display:grid;gap:var(--ds-space-2)}
    .studio-divider{margin:0;border:0;border-top:var(--ds-border-w) var(--ds-border-style) var(--ds-border)}
    .studio-tab{width:100%;text-align:left}
    .studio-tab[aria-selected="true"]{border-color:var(--ds-accent);background:color-mix(in oklab,var(--ds-accent) 16%,var(--ds-btn-bg));color:var(--ds-text)}
    .studio-main{min-width:0;padding:var(--ds-space-5)}
    .studio-panel[hidden]{display:none}
    .preset-grid{display:grid;gap:var(--ds-space-2)}
    .builder-grid{display:grid;gap:var(--ds-space-4);grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .builder-group{display:grid;gap:var(--ds-space-2);align-content:start}
    .builder-field{display:grid;gap:6px}
    .builder-field label{font-size:var(--ds-fs-1);color:var(--ds-text-muted);text-transform:uppercase;letter-spacing:.06em}
    .builder-field-row{display:grid;grid-template-columns:1fr 88px;gap:var(--ds-space-2);align-items:center}
    .builder-field-row.single{grid-template-columns:1fr}
    .builder-color{width:100%;min-height:var(--ds-control-h);border:var(--ds-border-w) var(--ds-border-style) var(--ds-input-border);background:var(--ds-input-bg);border-radius:var(--ds-radius-2);padding:4px}
    .builder-output{min-height:220px;width:100%;font-family:var(--ds-font-mono);font-size:var(--ds-fs-1)}
    .guide-grid{display:grid;gap:var(--ds-layout-gap);grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .mono{font-family:var(--ds-font-mono)}
    .control-grid{display:grid;gap:var(--ds-space-3);grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .control-box{border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-2);padding:var(--ds-space-3);background:var(--ds-bg-raised);display:grid;gap:var(--ds-space-2)}
    .pill-row{display:flex;flex-wrap:wrap;gap:var(--ds-space-2)}
    .pill{border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-pill);background:var(--ds-bg-soft);color:var(--ds-text);padding:6px 12px;font-size:var(--ds-fs-1)}
    .seg{display:inline-flex;border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-2);overflow:hidden}
    .seg button{border:0;border-right:var(--ds-border-w) var(--ds-border-style) var(--ds-border);background:var(--ds-bg-raised);color:var(--ds-text-muted);padding:8px 12px;cursor:pointer}
    .seg button:last-child{border-right:0}
    .seg button[aria-pressed="true"]{background:color-mix(in oklab,var(--ds-accent) 16%,var(--ds-bg-raised));color:var(--ds-text)}
    .arrow-control{display:inline-flex;gap:var(--ds-space-2);align-items:center}
    .arrow-value{min-width:50px;text-align:center;font-family:var(--ds-font-mono)}
    .scroll-demo{max-height:160px;overflow:auto;border:var(--ds-border-w) var(--ds-border-style) var(--ds-border);border-radius:var(--ds-radius-2);background:var(--ds-bg-raised);padding:var(--ds-space-3);display:grid;gap:var(--ds-space-2)}
    .scroll-demo::-webkit-scrollbar{width:10px;height:10px}
    .scroll-demo::-webkit-scrollbar-thumb{border-radius:10px;background:color-mix(in oklab,var(--ds-accent) 55%,var(--ds-bg-raised));border:2px solid transparent;background-clip:content-box}
    .scroll-demo::-webkit-scrollbar-track{background:transparent}
    .token-table code{white-space:nowrap}
    @media (max-width:980px){.studio{grid-template-columns:1fr}.studio-sidebar{position:static;height:auto;border-right:none;border-bottom:var(--ds-border-w) var(--ds-border-style) var(--ds-border)}.studio-main{padding:var(--ds-space-4)}}
  </style>
</head>
<body>
  <div class="studio">
    <aside class="studio-sidebar">
      <div class="studio-brand"><h1>Design System Studio</h1><p>Components, semantics, and live theme authoring.</p></div>
      <div class="ds-field">
        <label class="ds-label" for="themeSelect">Base Theme</label>
        <select id="themeSelect" class="ds-select">
          <option value="steel-night">Steel Night</option><option value="paper-mint">Paper Mint</option><option value="amber-terminal">Amber Terminal</option><option value="neon-grid">Neon Grid</option><option value="mono-slate">Mono Slate</option><option value="tech-grid">Tech Grid</option><option value="skeuo-panel">Skeuo Panel</option><option value="industrial-terminal">Industrial Terminal</option>
        </select>
      </div>
      <hr class="studio-divider">
      <nav class="studio-nav" role="tablist" aria-label="Studio sections">
        <button class="ds-btn studio-tab" type="button" data-panel="guide" aria-selected="true">Guide</button>
        <button class="ds-btn studio-tab" type="button" data-panel="builder" aria-selected="false">Theme Builder</button>
        <button class="ds-btn studio-tab" type="button" data-panel="components" aria-selected="false">Components</button>
      </nav>
      <p class="ds-muted">Builder edits apply in real time to this preview page.</p>
    </aside>

    <main class="studio-main">
      <section id="panel-components" class="studio-panel ds-stack" hidden>
        <article class="ds-card ds-stack">
          <div><h2 class="ds-card-title">Component Library</h2><p class="ds-card-subtitle">Preview how tokens affect common UI patterns.</p></div>
          <div class="ds-grid ds-grid-2">
            <article class="ds-card ds-stack">
              <h3 class="ds-card-title">Buttons and States</h3>
              <div class="ds-toolbar"><button class="ds-btn ds-btn-primary" type="button">Primary</button><button class="ds-btn" type="button">Secondary</button><button class="ds-btn ds-btn-danger" type="button">Danger</button><button class="ds-btn ds-btn-ghost" type="button">Ghost</button><button class="ds-btn ds-btn-sm" type="button">Small</button><button class="ds-btn" type="button" disabled>Disabled</button><button class="ds-btn is-loading" type="button">Loading...</button></div>
              <div class="pill-row"><span class="pill">Pill</span><span class="ds-badge success">Status</span><span class="ds-chip">Chip</span><span class="ds-chip ds-chip-accent">Accent Chip</span></div>
            </article>
            <article class="ds-card ds-stack">
              <h3 class="ds-card-title">Inputs and Fields</h3>
              <div class="ds-field"><label class="ds-label" for="demoName">Name</label><input id="demoName" class="ds-input" type="text" placeholder="Project name"></div>
              <div class="ds-grid" style="grid-template-columns:1fr 1fr;"><div class="ds-field"><label class="ds-label" for="demoEmail">Email</label><input id="demoEmail" class="ds-input" type="email" placeholder="name@example.com"></div><div class="ds-field"><label class="ds-label" for="demoRole">Role</label><select id="demoRole" class="ds-select"><option>Designer</option><option>Developer</option><option>Product</option></select></div></div>
              <div class="ds-field"><label class="ds-label" for="demoNotes">Notes</label><textarea id="demoNotes" class="ds-textarea" placeholder="Notes..."></textarea></div>
            </article>
          </div>
          <div class="ds-grid ds-grid-2">
            <article class="ds-card ds-stack">
              <h3 class="ds-card-title">Controls</h3>
              <div class="control-grid">
                <div class="control-box"><strong>Checkboxes</strong><label><input type="checkbox" checked> Default checked</label><label><input type="checkbox"> Default unchecked</label></div>
                <div class="control-box"><strong>Radio</strong><label><input type="radio" name="demoPlan" checked> Monthly</label><label><input type="radio" name="demoPlan"> Annual</label></div>
                <div class="control-box"><strong>Toggle</strong><label class="ds-switch"><input type="checkbox" checked><span class="ds-switch-track"></span><span>Auto sync</span></label></div>
                <div class="control-box"><strong>Slider</strong><input id="sliderDemo" type="range" min="0" max="100" value="60"><span class="ds-muted mono" id="sliderDemoValue">60</span></div>
                <div class="control-box"><strong>Segmented</strong><div class="seg" id="segDemo"><button type="button" aria-pressed="true">Day</button><button type="button" aria-pressed="false">Week</button><button type="button" aria-pressed="false">Month</button></div></div>
                <div class="control-box"><strong>Control Arrows</strong><div class="arrow-control"><button class="ds-btn ds-btn-sm" id="arrowDownBtn" type="button">v</button><span class="arrow-value" id="arrowValue">0</span><button class="ds-btn ds-btn-sm" id="arrowUpBtn" type="button">^</button></div></div>
              </div>
            </article>

            <article class="ds-card ds-stack">
              <h3 class="ds-card-title">Scrollbars and Popouts</h3>
              <div class="scroll-demo" id="scrollDemo"><div class="ds-chip">Scrollable item 1</div><div class="ds-chip">Scrollable item 2</div><div class="ds-chip">Scrollable item 3</div><div class="ds-chip">Scrollable item 4</div><div class="ds-chip">Scrollable item 5</div><div class="ds-chip">Scrollable item 6</div><div class="ds-chip">Scrollable item 7</div><div class="ds-chip">Scrollable item 8</div><div class="ds-chip">Scrollable item 9</div><div class="ds-chip">Scrollable item 10</div></div>
              <div class="ds-toolbar">
                <div class="ds-dropdown" id="actionsDropdown"><button class="ds-btn" id="dropdownToggle" type="button" aria-expanded="false">Open Menu</button><div class="ds-dropdown-menu" role="menu" aria-label="Actions menu"><button class="ds-menu-item" type="button">New file</button><button class="ds-menu-item" type="button">Duplicate</button><button class="ds-menu-item" type="button">Archive</button></div></div>
                <div class="ds-popover-wrap" id="helpPopover"><button class="ds-btn" id="popoverToggle" type="button">Show Popover</button><div class="ds-popover" role="status">Quick contextual help lives here.</div></div>
              </div>
              <div class="ds-toolbar"><button class="ds-btn ds-btn-primary" id="openModalBtn" type="button">Open Modal</button><button class="ds-btn" id="openDrawerBtn" type="button">Open Drawer</button><button class="ds-btn" id="toastSuccessBtn" type="button">Toast Success</button><button class="ds-btn ds-btn-danger" id="toastErrorBtn" type="button">Toast Error</button></div>
            </article>
          </div>

          <article class="ds-card ds-stack">
            <h3 class="ds-card-title">Table</h3>
            <div class="ds-table-wrap"><table class="ds-table"><thead><tr><th>Project</th><th>Owner</th><th>Status</th><th>Updated</th></tr></thead><tbody><tr><td>Quickdash</td><td>SV</td><td><span class="ds-badge success">Active</span></td><td>Today</td></tr><tr><td>Nomz</td><td>SV</td><td><span class="ds-badge warning">Review</span></td><td>Yesterday</td></tr><tr><td>MapitMine</td><td>SV</td><td><span class="ds-badge danger">Blocked</span></td><td>2 days ago</td></tr></tbody></table></div>
          </article>
        </article>
      </section>

      <section id="panel-guide" class="studio-panel ds-stack">
        <article class="ds-card ds-stack" id="guide-intro">
          <h2 class="ds-card-title">Getting Started</h2>
          <p class="ds-card-subtitle">This repository gives you a reusable tokenized design system with composable theme presets.</p>
          <div class="ds-grid" style="grid-template-columns:repeat(auto-fit,minmax(280px,1fr));">
            <div class="ds-note">
              <strong>Introduction</strong>
              <p class="ds-muted">Choose a base theme for orientation, then use the Theme Builder to compose Color Family + Hue + Style + Scale. Export your theme and add it to your projects.</p>
            </div>
            <div class="ds-note">
              <strong>Table of Contents</strong>
              <p class="ds-muted mono">1. Getting Started<br>2. Token Philosophy<br>3. Token Encyclopedia<br>4. GitHub Integration<br>5. Local Package Export</p>
            </div>
          </div>
        </article>
        <article class="ds-card ds-stack">
          <h2 class="ds-card-title">Token Philosophy and Logic</h2>
          <p class="ds-card-subtitle">How and why this system is structured.</p>
          <div class="guide-grid">
            <article class="ds-card ds-stack"><h3>Core Philosophy</h3><p class="ds-muted">Themes should change personality without rewriting components. Components should never directly depend on fixed colors or one-off dimensions.</p><pre class="ds-code mono">Component class
  -> component tokens (button/input/card)
     -> semantic tokens (bg/text/border/accent)
        -> theme values</pre></article>
            <article class="ds-card ds-stack"><h3>Token Creation Rules</h3><p class="ds-muted">Create tokens when the value has reuse potential or must vary by theme family.</p><pre class="ds-code mono">Use token when:
- value appears in 2+ components
- value needs theme variation
- value represents intent (warning, accent)

Avoid token when:
- one-off layout local to one element</pre></article>
            <article class="ds-card ds-stack"><h3>Preset Architecture</h3><p class="ds-muted">Builder presets are organized by categories so combinations are composable.</p><pre class="ds-code mono">Color Family + Hue -> full semantic palette behavior
Style Preset (terminal|technical|paper|skeuo|glassmorph|material)
  -> geometry + depth language
Scale Preset -> size + spacing density

Final custom theme = Color Family + Hue + Style + Scale + manual edits</pre></article>
            <article class="ds-card ds-stack"><h3>Preset Effect Map</h3><p class="ds-muted">How each preset layer modifies tokens and aliases.</p><pre class="ds-code mono">Color Family:
- contrast model (light/dark, mono/bold)
- semantic intent tuning (success/warning/danger)

Hue:
- sets primary hue anchor
- combines with family behavior to generate semantic palette

Style:
- shape, border language, shadows, textures
- component token overrides (button/input/card)

Scale:
- density, control height, spacing cadence

Alias flow:
component token -> semantic token -> foundation token
ex: --ds-btn-bg -> --ds-bg-raised -> --ds-bg

Preset combo examples:
- electric + cyan + hud-glow + compact (cyber HUD)
- paper + emerald + skeuo + standard (premium productivity)
- monochrome + gray + neo-brutal + compact (ops console)
- pastel + rose + material + comfortable (friendly SaaS)</pre></article>
            <article class="ds-card ds-stack"><h3>Implementation Pattern</h3><p class="ds-muted">For new components, define local component tokens first, then map them to semantic tokens.</p><pre class="ds-code mono">.ds-new {
  background: var(--ds-new-bg);
  border-color: var(--ds-new-border);
}

:root {
  --ds-new-bg: var(--ds-bg-raised);
  --ds-new-border: var(--ds-border);
}</pre></article>
          </div>
        </article>

        <article class="ds-card ds-stack token-table">
          <h2 class="ds-card-title">Token Encyclopedia</h2>
          <p class="ds-card-subtitle">Reference of key token families and expected usage.</p>
          <div class="ds-table-wrap"><table class="ds-table"><thead><tr><th>Category</th><th>Token Family</th><th>Purpose</th><th>Examples</th></tr></thead><tbody>
            <tr><td>Foundation</td><td><code>--ds-space-*</code></td><td>Global spacing scale</td><td>card padding, gaps, control spacing</td></tr>
            <tr><td>Foundation</td><td><code>--ds-radius-*</code></td><td>Shape system</td><td>soft vs technical corners</td></tr>
            <tr><td>Foundation</td><td><code>--ds-fs-*</code>, <code>--ds-lh-base</code></td><td>Type scale and rhythm</td><td>labels, body, headings</td></tr>
            <tr><td>Semantic</td><td><code>--ds-bg*</code></td><td>Surface hierarchy</td><td>page, elevated panels, controls</td></tr>
            <tr><td>Semantic</td><td><code>--ds-text*</code></td><td>Text hierarchy</td><td>primary text, muted metadata</td></tr>
            <tr><td>Semantic</td><td><code>--ds-border*</code></td><td>Outline hierarchy</td><td>default and strong separators</td></tr>
            <tr><td>Semantic</td><td><code>--ds-accent</code>, <code>--ds-focus</code></td><td>Interaction cues</td><td>active tabs, focus rings, key actions</td></tr>
            <tr><td>Semantic</td><td><code>--ds-success|warning|danger|info</code></td><td>Intent states</td><td>alerts, badges, validation states</td></tr>
            <tr><td>Component</td><td><code>--ds-btn-*</code></td><td>Button behavior/look</td><td>primary gradient, press depth, border</td></tr>
            <tr><td>Component</td><td><code>--ds-input-*</code></td><td>Input behavior/look</td><td>field background, placeholder, inset depth</td></tr>
            <tr><td>Component</td><td><code>--ds-card-*</code></td><td>Container style</td><td>panel contrast, border, shadow</td></tr>
            <tr><td>Style</td><td><code>--ds-border-w</code>, <code>--ds-border-style</code></td><td>Visual language</td><td>minimal 1px vs industrial 2px frames</td></tr>
            <tr><td>Style</td><td><code>--ds-btn-shadow*</code>, <code>--ds-input-shadow</code></td><td>Depth model</td><td>flat, technical, skeuo</td></tr>
            <tr><td>Style</td><td><code>--ds-body-bg-image</code>, <code>--ds-card-bg-image</code></td><td>Material texture</td><td>glass, grain, scanline effects</td></tr>
            <tr><td>Scale</td><td><code>--ds-control-h*</code>, <code>--ds-layout-gap</code>, <code>--ds-card-pad</code></td><td>UI density</td><td>compact dashboards vs spacious tools</td></tr>
          </tbody></table></div>
        </article>
        <article class="ds-card ds-stack" id="guide-usage">
          <h2 class="ds-card-title">Using This Repository In Projects</h2>
          <div class="guide-grid">
            <article class="ds-card ds-stack">
              <h3>GitHub Workflow</h3>
              <pre class="ds-code mono">1. Clone this repository
2. Copy _DesignSystem into your app repo
3. Link your app HTML:
   &lt;link rel="stylesheet" href="./_DesignSystem/theme.css"&gt;
4. Set the theme on root:
   &lt;html data-theme="steel-night"&gt;
5. Append custom exported themes to:
   _DesignSystem/css/themes.css</pre>
            </article>
            <article class="ds-card ds-stack">
              <h3>Local Package Workflow</h3>
              <pre class="ds-code mono">1. Build your theme in Theme Builder
2. Click Generate Export
3. Click Download Theme Package
4. Drag extracted files into your project folder
5. Follow INSTALL.md in the package</pre>
            </article>
          </div>
        </article>
      </section>
      <section id="panel-builder" class="studio-panel ds-stack" hidden>
        <article class="ds-card ds-stack">
          <div><h2 class="ds-card-title">Theme Builder</h2><p class="ds-card-subtitle">Load modular presets (Color Family + Hue + Style + Scale), then tune tokens and export a custom theme block.</p></div>
          <div class="preset-grid ds-card">
            <h3 class="ds-card-title">Preset Loader</h3>
            <div class="ds-grid" style="grid-template-columns:repeat(auto-fit,minmax(220px,1fr));">
              <div class="ds-field"><label class="ds-label" for="familyPresetSelect">Color Family</label><select id="familyPresetSelect" class="ds-select"></select></div><div class="ds-field"><label class="ds-label" for="huePresetSelect">Hue</label><select id="huePresetSelect" class="ds-select"></select></div>
              <div class="ds-field"><label class="ds-label" for="stylePresetSelect">Style Preset</label><select id="stylePresetSelect" class="ds-select"></select></div>
              <div class="ds-field"><label class="ds-label" for="scalePresetSelect">Scale Preset</label><select id="scalePresetSelect" class="ds-select"></select></div>
            </div>
            <div class="ds-toolbar"><button class="ds-btn ds-btn-primary" id="applyPresetBtn" type="button">Apply Preset Combination</button><button class="ds-btn ds-btn-danger" id="resetOverridesBtn" type="button">Reset Custom Overrides</button></div>
          </div>
          <div class="ds-field"><label class="ds-label" for="themeNameInput">Theme Name</label><input id="themeNameInput" class="ds-input" type="text" value="custom-theme" placeholder="custom-theme"></div>
          <div class="builder-grid" id="builderGroups"></div>
          <div class="ds-stack"><label class="ds-label" for="themeExportOutput">Exported Theme Block</label><textarea id="themeExportOutput" class="ds-textarea builder-output" readonly></textarea><div class="ds-toolbar"><button class="ds-btn ds-btn-primary" id="exportThemeBtn" type="button">Generate Export</button><button class="ds-btn" id="copyExportBtn" type="button">Copy Export</button><button class="ds-btn" id="downloadPackageBtn" type="button">Download Theme Package</button></div></div>
        </article>
      </section>
    </main>
  </div>

  <dialog id="modal" class="ds-modal"><div class="ds-modal-panel ds-stack"><div><h3 class="ds-card-title">Confirm Action</h3><p class="ds-muted">This is a reusable modal container for important decisions.</p></div><div class="ds-toolbar"><button class="ds-btn" id="closeModalBtn" type="button">Cancel</button><button class="ds-btn ds-btn-primary" type="button">Confirm</button></div></div></dialog>
  <dialog id="drawer" class="ds-drawer"><div class="ds-drawer-panel ds-stack"><div><h3 class="ds-card-title">Side Panel</h3><p class="ds-muted">Use this as a settings drawer, inspector, or history view.</p></div><div class="ds-field"><label class="ds-label" for="drawerInput">Quick note</label><input id="drawerInput" class="ds-input" type="text" placeholder="Type here"></div><button class="ds-btn" id="closeDrawerBtn" type="button">Close Drawer</button></div></dialog>
  <dialog id="resetConfirmDialog" class="ds-modal"><div class="ds-modal-panel ds-stack"><div><h3 class="ds-card-title">Reset Theme Overrides?</h3><p class="ds-muted">This will clear all manual token edits and reapply the mapped preset recipe for the selected base theme.</p></div><label class="ds-check"><input type="checkbox" id="skipResetConfirmChk"> Do not show again</label><div class="ds-toolbar"><button class="ds-btn" id="cancelResetBtn" type="button">Cancel</button><button class="ds-btn ds-btn-danger" id="confirmResetBtn" type="button">Reset Overrides</button></div></div></dialog>
  <div class="ds-toast-stack" id="toastStack" aria-live="polite"></div>

  <script>
    (function () {
      const root = document.documentElement;
      const storageKey = "ds-theme";
      const resetConfirmKey = "ds-skip-reset-confirm";
      const themeSelect = document.getElementById("themeSelect");
      const controlMap = new Map();
      const tokenGroups = [
        { name: "Colors", controls: [
          { token: "--ds-bg", type: "color" }, { token: "--ds-bg-elevated", type: "color" }, { token: "--ds-bg-raised", type: "color" }, { token: "--ds-bg-soft", type: "color" },
          { token: "--ds-text", type: "color" }, { token: "--ds-text-muted", type: "color" }, { token: "--ds-border", type: "color" }, { token: "--ds-border-strong", type: "color" },
          { token: "--ds-accent", type: "color" }, { token: "--ds-accent-strong", type: "color" }, { token: "--ds-focus", type: "color" }, { token: "--ds-success", type: "color" },
          { token: "--ds-warning", type: "color" }, { token: "--ds-danger", type: "color" }, { token: "--ds-info", type: "color" }, { token: "--ds-btn-primary-text", type: "color" }
        ]},
        { name: "Typography", controls: [
          { token: "--ds-font-sans", type: "select", options: ["\"Inter\", \"Segoe UI\", Roboto, Arial, sans-serif", "\"Space Mono\", Consolas, \"Courier New\", monospace", "\"Georgia\", \"Times New Roman\", serif", "\"Trebuchet MS\", \"Segoe UI\", sans-serif"] },
          { token: "--ds-font-mono", type: "select", options: ["\"Space Mono\", Consolas, \"Courier New\", monospace", "\"Fira Code\", Consolas, monospace", "\"JetBrains Mono\", Consolas, monospace"] },
          { token: "--ds-fs-1", type: "length", unit: "px" }, { token: "--ds-fs-2", type: "length", unit: "px" }, { token: "--ds-fs-3", type: "length", unit: "px" },
          { token: "--ds-fs-4", type: "length", unit: "px" }, { token: "--ds-fs-5", type: "length", unit: "px" }, { token: "--ds-lh-base", type: "number", step: "0.01" }, { token: "--ds-label-spacing", type: "length", unit: "em" }
        ]},
        { name: "Layout and Scale", controls: [
          { token: "--ds-space-1", type: "length", unit: "px" }, { token: "--ds-space-2", type: "length", unit: "px" }, { token: "--ds-space-3", type: "length", unit: "px" },
          { token: "--ds-space-4", type: "length", unit: "px" }, { token: "--ds-space-5", type: "length", unit: "px" }, { token: "--ds-space-6", type: "length", unit: "px" },
          { token: "--ds-space-8", type: "length", unit: "px" }, { token: "--ds-layout-gap", type: "length", unit: "px" }, { token: "--ds-card-pad", type: "length", unit: "px" },
          { token: "--ds-control-h", type: "length", unit: "px" }, { token: "--ds-control-h-sm", type: "length", unit: "px" }
        ]},
        { name: "Shape and Borders", controls: [
          { token: "--ds-border-w", type: "length", unit: "px" }, { token: "--ds-radius-1", type: "length", unit: "px" }, { token: "--ds-radius-2", type: "length", unit: "px" },
          { token: "--ds-radius-3", type: "length", unit: "px" }, { token: "--ds-radius-4", type: "length", unit: "px" }, { token: "--ds-radius-pill", type: "length", unit: "px" },
          { token: "--ds-border-style", type: "select", options: ["solid", "dashed", "dotted", "double"] }, { token: "--ds-label-transform", type: "select", options: ["uppercase", "none", "capitalize"] }
        ]},
        { name: "Surface and Depth", controls: [
          { token: "--ds-shadow-sm", type: "text" }, { token: "--ds-shadow-md", type: "text" }, { token: "--ds-card-shadow", type: "text" },
          { token: "--ds-btn-shadow", type: "text" }, { token: "--ds-btn-shadow-hover", type: "text" }, { token: "--ds-btn-shadow-active", type: "text" },
          { token: "--ds-input-shadow", type: "text" }, { token: "--ds-body-bg-image", type: "text" }, { token: "--ds-card-bg-image", type: "text" }, { token: "--ds-bg-overlay", type: "text" }
        ]},
        { name: "Buttons and Inputs", controls: [
          { token: "--ds-btn-bg", type: "text" }, { token: "--ds-btn-bg-hover", type: "text" }, { token: "--ds-btn-border", type: "color" }, { token: "--ds-btn-text", type: "color" },
          { token: "--ds-btn-primary-bg", type: "text" }, { token: "--ds-btn-primary-bg-hover", type: "text" }, { token: "--ds-btn-primary-border", type: "color" },
          { token: "--ds-btn-press-transform", type: "text" }, { token: "--ds-input-bg", type: "text" }, { token: "--ds-input-border", type: "color" }, { token: "--ds-input-text", type: "color" }, { token: "--ds-input-placeholder", type: "color" }
        ]}
      ];
      const huePresets={cyan:{h:190},magenta:{h:320},violet:{h:265},red:{h:4},green:{h:140},blue:{h:214},yellow:{h:52},lime:{h:88},amber:{h:38},teal:{h:176},orange:{h:26},rose:{h:346},emerald:{h:162},cobalt:{h:223},ultraviolet:{h:278},gray:{neutral:"gray"},steel:{neutral:"steel"},slate:{neutral:"slate"},black:{neutral:"black"},white:{neutral:"white"}};
      const colorFamilyPresets={monochrome:{mode:"dark",sat:8,bgL:10,elevL:14,raisedL:18,softL:22,textL:92,mutedL:72,borderL:30,borderStrongL:44,accentL:88,accentSat:6},bold:{mode:"dark",sat:78,bgL:9,elevL:13,raisedL:18,softL:23,textL:95,mutedL:76,borderL:31,borderStrongL:50,accentL:60,accentSat:92},paper:{mode:"light",sat:24,bgL:97,elevL:100,raisedL:94,softL:90,textL:14,mutedL:36,borderL:76,borderStrongL:62,accentL:42,accentSat:52},pastel:{mode:"light",sat:38,bgL:95,elevL:100,raisedL:92,softL:88,textL:16,mutedL:40,borderL:74,borderStrongL:60,accentL:56,accentSat:58},cathode:{mode:"dark",sat:92,bgL:7,elevL:10,raisedL:14,softL:18,textL:92,mutedL:72,borderL:26,borderStrongL:40,accentL:68,accentSat:100,glow:true},electric:{mode:"dark",sat:96,bgL:6,elevL:9,raisedL:13,softL:18,textL:96,mutedL:76,borderL:24,borderStrongL:38,accentL:72,accentSat:100,glow:true},noir:{mode:"dark",sat:26,bgL:5,elevL:8,raisedL:12,softL:16,textL:90,mutedL:66,borderL:22,borderStrongL:34,accentL:64,accentSat:58},frost:{mode:"light",sat:30,bgL:98,elevL:100,raisedL:96,softL:93,textL:18,mutedL:44,borderL:78,borderStrongL:62,accentL:50,accentSat:48},sunset:{mode:"dark",sat:74,bgL:8,elevL:12,raisedL:16,softL:21,textL:94,mutedL:74,borderL:30,borderStrongL:46,accentL:62,accentSat:88}};
      const stylePresets={terminal:{"--ds-font-sans":"\"Space Mono\", Consolas, \"Courier New\", monospace","--ds-radius-1":"2px","--ds-radius-2":"2px","--ds-radius-3":"4px","--ds-radius-4":"6px","--ds-radius-pill":"4px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-label-transform":"uppercase","--ds-label-spacing":"0.12em","--ds-card-shadow":"0 0 0 1px rgba(255,255,255,0.05) inset, 0 0 24px color-mix(in oklab,var(--ds-accent) 15%, transparent)","--ds-btn-shadow":"none","--ds-btn-shadow-hover":"none","--ds-btn-shadow-active":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 45%, transparent)","--ds-input-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 25%, transparent)","--ds-body-bg-image":"repeating-linear-gradient(0deg, rgba(255,255,255,0.012) 0px, rgba(255,255,255,0.012) 2px, transparent 2px, transparent 6px)","--ds-card-bg-image":"linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.05))"},technical:{"--ds-font-sans":"\"Space Mono\", Consolas, \"Courier New\", monospace","--ds-radius-1":"0px","--ds-radius-2":"0px","--ds-radius-3":"0px","--ds-radius-4":"0px","--ds-radius-pill":"0px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"none","--ds-btn-shadow":"none","--ds-btn-shadow-hover":"inset 0 0 0 1px var(--ds-accent)","--ds-btn-shadow-active":"inset 0 0 0 1px var(--ds-accent-strong)","--ds-input-shadow":"none","--ds-body-bg-image":"none","--ds-card-bg-image":"none","--ds-label-transform":"uppercase","--ds-label-spacing":"0.12em"},paper:{"--ds-radius-1":"5px","--ds-radius-2":"10px","--ds-radius-3":"14px","--ds-radius-4":"18px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 2px 10px rgba(40,45,35,0.08)","--ds-btn-shadow":"none","--ds-btn-shadow-hover":"none","--ds-btn-shadow-active":"none","--ds-input-shadow":"none","--ds-body-bg-image":"none","--ds-card-bg-image":"none","--ds-label-transform":"uppercase","--ds-label-spacing":"0.06em"},skeuo:{"--ds-radius-1":"5px","--ds-radius-2":"10px","--ds-radius-3":"14px","--ds-radius-4":"18px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 1px 0 rgba(255,255,255,0.7) inset, 0 10px 18px rgba(73,86,108,0.2)","--ds-btn-shadow":"0 1px 0 rgba(255,255,255,0.85) inset, 0 -1px 0 rgba(99,112,134,0.25) inset, 0 2px 4px rgba(71,85,107,0.22)","--ds-btn-shadow-hover":"0 1px 0 rgba(255,255,255,0.9) inset, 0 -1px 0 rgba(99,112,134,0.3) inset, 0 3px 6px rgba(71,85,107,0.22)","--ds-btn-shadow-active":"0 1px 2px rgba(67,77,96,0.35) inset","--ds-input-shadow":"0 1px 2px rgba(76,90,112,0.3) inset, 0 1px 0 rgba(255,255,255,0.8)","--ds-body-bg-image":"none","--ds-card-bg-image":"none","--ds-btn-press-transform":"translateY(1px)"},glassmorph:{"--ds-radius-1":"8px","--ds-radius-2":"14px","--ds-radius-3":"18px","--ds-radius-4":"24px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 8px 24px rgba(0,0,0,0.25)","--ds-btn-shadow":"0 1px 0 rgba(255,255,255,0.25) inset","--ds-btn-shadow-hover":"0 1px 0 rgba(255,255,255,0.35) inset","--ds-input-shadow":"0 1px 0 rgba(255,255,255,0.2) inset","--ds-body-bg-image":"radial-gradient(circle at 15% 10%, rgba(255,255,255,0.15), transparent 45%)","--ds-card-bg-image":"linear-gradient(145deg, rgba(255,255,255,0.2), rgba(255,255,255,0.04))","--ds-bg-overlay":"rgba(10,18,34,0.45)"},material:{"--ds-radius-1":"4px","--ds-radius-2":"10px","--ds-radius-3":"14px","--ds-radius-4":"18px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 2px 10px rgba(0,0,0,0.16)","--ds-btn-shadow":"0 1px 0 rgba(255,255,255,0.08) inset","--ds-btn-shadow-hover":"0 1px 0 rgba(255,255,255,0.12) inset","--ds-btn-shadow-active":"0 1px 2px rgba(0,0,0,0.2) inset","--ds-input-shadow":"none","--ds-body-bg-image":"none","--ds-card-bg-image":"none"},"hud-glow":{"--ds-font-sans":"\"Space Mono\", Consolas, \"Courier New\", monospace","--ds-radius-1":"2px","--ds-radius-2":"3px","--ds-radius-3":"4px","--ds-radius-4":"6px","--ds-radius-pill":"6px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-label-transform":"uppercase","--ds-label-spacing":"0.1em","--ds-card-shadow":"0 0 18px color-mix(in oklab,var(--ds-accent) 20%, transparent), inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 24%, transparent)","--ds-btn-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 30%, transparent), 0 0 10px color-mix(in oklab,var(--ds-accent) 22%, transparent)","--ds-btn-shadow-hover":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 44%, transparent), 0 0 14px color-mix(in oklab,var(--ds-accent) 34%, transparent)","--ds-btn-shadow-active":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 55%, transparent)","--ds-input-shadow":"inset 0 0 0 1px color-mix(in oklab,var(--ds-accent) 28%, transparent)","--ds-body-bg-image":"repeating-linear-gradient(-45deg, color-mix(in oklab, var(--ds-accent) 8%, transparent) 0 1px, transparent 1px 11px)","--ds-card-bg-image":"linear-gradient(180deg, color-mix(in oklab,var(--ds-bg-elevated) 92%, var(--ds-accent) 8%), var(--ds-bg-elevated))"},"neo-brutal":{"--ds-radius-1":"0px","--ds-radius-2":"0px","--ds-radius-3":"0px","--ds-radius-4":"0px","--ds-radius-pill":"0px","--ds-border-w":"2px","--ds-border-style":"solid","--ds-card-shadow":"6px 6px 0 color-mix(in oklab,var(--ds-accent) 25%, var(--ds-bg))","--ds-btn-shadow":"3px 3px 0 color-mix(in oklab,var(--ds-accent) 35%, var(--ds-bg))","--ds-btn-shadow-hover":"4px 4px 0 color-mix(in oklab,var(--ds-accent) 40%, var(--ds-bg))","--ds-btn-shadow-active":"1px 1px 0 color-mix(in oklab,var(--ds-accent) 40%, var(--ds-bg))","--ds-input-shadow":"none","--ds-body-bg-image":"none","--ds-card-bg-image":"none","--ds-btn-press-transform":"translateY(1px)"},arcade:{"--ds-font-sans":"\"Trebuchet MS\", \"Segoe UI\", sans-serif","--ds-radius-1":"6px","--ds-radius-2":"12px","--ds-radius-3":"16px","--ds-radius-4":"20px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 0 24px color-mix(in oklab,var(--ds-accent) 22%, transparent)","--ds-btn-shadow":"0 0 0 1px color-mix(in oklab,var(--ds-accent) 42%, transparent), 0 0 14px color-mix(in oklab,var(--ds-accent) 32%, transparent)","--ds-btn-shadow-hover":"0 0 0 1px color-mix(in oklab,var(--ds-accent) 56%, transparent), 0 0 18px color-mix(in oklab,var(--ds-accent) 45%, transparent)","--ds-btn-shadow-active":"inset 0 1px 2px rgba(0,0,0,0.25)","--ds-input-shadow":"0 0 0 1px color-mix(in oklab,var(--ds-accent) 24%, transparent) inset","--ds-body-bg-image":"radial-gradient(circle at 20% 12%, color-mix(in oklab, var(--ds-accent) 20%, transparent), transparent 45%)","--ds-card-bg-image":"linear-gradient(160deg, color-mix(in oklab,var(--ds-accent) 16%, transparent), transparent 50%)"},editorial:{"--ds-font-sans":"\"Georgia\", \"Times New Roman\", serif","--ds-radius-1":"2px","--ds-radius-2":"4px","--ds-radius-3":"6px","--ds-radius-4":"8px","--ds-radius-pill":"999px","--ds-border-w":"1px","--ds-border-style":"solid","--ds-card-shadow":"0 1px 0 rgba(0,0,0,0.05), 0 6px 14px rgba(0,0,0,0.08)","--ds-btn-shadow":"none","--ds-btn-shadow-hover":"none","--ds-btn-shadow-active":"none","--ds-input-shadow":"none","--ds-body-bg-image":"none","--ds-card-bg-image":"none","--ds-label-transform":"none","--ds-label-spacing":"0.02em"}};
      const scalePresets={compact:{"--ds-space-1":"3px","--ds-space-2":"6px","--ds-space-3":"9px","--ds-space-4":"12px","--ds-space-5":"16px","--ds-space-6":"20px","--ds-space-8":"26px","--ds-layout-gap":"12px","--ds-card-pad":"12px","--ds-control-h":"32px","--ds-control-h-sm":"28px","--ds-fs-1":"11px","--ds-fs-2":"13px","--ds-fs-3":"15px","--ds-fs-4":"18px","--ds-fs-5":"24px"},standard:{"--ds-space-1":"4px","--ds-space-2":"8px","--ds-space-3":"12px","--ds-space-4":"16px","--ds-space-5":"20px","--ds-space-6":"24px","--ds-space-8":"32px","--ds-layout-gap":"16px","--ds-card-pad":"16px","--ds-control-h":"38px","--ds-control-h-sm":"32px","--ds-fs-1":"12px","--ds-fs-2":"14px","--ds-fs-3":"16px","--ds-fs-4":"20px","--ds-fs-5":"28px"},comfortable:{"--ds-space-1":"5px","--ds-space-2":"10px","--ds-space-3":"14px","--ds-space-4":"20px","--ds-space-5":"24px","--ds-space-6":"30px","--ds-space-8":"38px","--ds-layout-gap":"20px","--ds-card-pad":"20px","--ds-control-h":"44px","--ds-control-h-sm":"36px","--ds-fs-1":"13px","--ds-fs-2":"15px","--ds-fs-3":"18px","--ds-fs-4":"22px","--ds-fs-5":"32px"}};
      const baseThemePresetMap={"steel-night":{family:"bold",hue:"steel",style:"technical",scale:"standard"},"paper-mint":{family:"paper",hue:"green",style:"paper",scale:"standard"},"amber-terminal":{family:"cathode",hue:"amber",style:"terminal",scale:"compact"},"neon-grid":{family:"cathode",hue:"cyan",style:"terminal",scale:"standard"},"mono-slate":{family:"monochrome",hue:"gray",style:"technical",scale:"standard"},"tech-grid":{family:"bold",hue:"blue",style:"technical",scale:"compact"},"skeuo-panel":{family:"paper",hue:"blue",style:"skeuo",scale:"standard"},"industrial-terminal":{family:"cathode",hue:"lime",style:"technical",scale:"compact"}};
const familyPresetSelect=document.getElementById("familyPresetSelect"); const huePresetSelect=document.getElementById("huePresetSelect"); const stylePresetSelect=document.getElementById("stylePresetSelect"); const scalePresetSelect=document.getElementById("scalePresetSelect");
function fillPresetSelect(el,dict){Object.keys(dict).forEach((k)=>{const o=document.createElement("option");o.value=k;o.textContent=k;el.appendChild(o);});}
fillPresetSelect(familyPresetSelect,colorFamilyPresets); fillPresetSelect(huePresetSelect,huePresets); fillPresetSelect(stylePresetSelect,stylePresets); fillPresetSelect(scalePresetSelect,scalePresets); familyPresetSelect.value="bold"; huePresetSelect.value="cyan"; stylePresetSelect.value="material"; scalePresetSelect.value="standard";
function hsl(h,s,l){return "hsl("+Math.round(h)+" "+Math.round(s)+"% "+Math.round(l)+"%)";}
function clamp(v,min,max){return Math.min(max,Math.max(min,v));}
function rotate(h,d){return (h+d+360)%360;}
function hueProfile(hueKey){const hue=huePresets[hueKey]||huePresets.cyan;if(typeof hue.h==="number")return {h:hue.h,neutral:false};const map={gray:220,steel:210,slate:230,black:220,white:45};return {h:map[hue.neutral]||200,neutral:true};}
function buildColorBundle(familyKey,hueKey){const fam=colorFamilyPresets[familyKey]||colorFamilyPresets.bold;const hue=hueProfile(hueKey);const h=hue.h;const sat=clamp(hue.neutral?Math.max(6,fam.sat*0.28):fam.sat,4,96);const aSat=clamp(hue.neutral?Math.max(4,fam.accentSat*0.25):fam.accentSat,4,100);const isLight=fam.mode==="light";const textSat=isLight?Math.max(6,sat*0.18):Math.max(8,sat*0.24);const bundle={"--ds-bg":hsl(h,clamp(sat*0.22,5,34),fam.bgL),"--ds-bg-elevated":hsl(h,clamp(sat*0.24,6,36),fam.elevL),"--ds-bg-raised":hsl(h,clamp(sat*0.3,8,40),fam.raisedL),"--ds-bg-soft":hsl(h,clamp(sat*0.36,10,46),fam.softL),"--ds-text":hsl(h,textSat,fam.textL),"--ds-text-muted":hsl(h,clamp(sat*0.2,8,30),fam.mutedL),"--ds-text-inverse":isLight?"#0f1216":"#f6fbff","--ds-border":hsl(h,clamp(sat*0.26,8,36),fam.borderL),"--ds-border-strong":hsl(h,clamp(sat*0.34,12,44),fam.borderStrongL),"--ds-accent":hsl(h,aSat,fam.accentL),"--ds-accent-strong":hsl(h,aSat,clamp(fam.accentL+(isLight?-9:8),6,94)),"--ds-focus":hsl(h,clamp(aSat*0.92,0,100),clamp(fam.accentL+(isLight?-5:16),6,96)),"--ds-success":hsl(rotate(h,118),clamp(aSat*0.74,20,95),clamp(fam.accentL+(isLight?-8:8),8,90)),"--ds-warning":hsl(rotate(h,54),clamp(aSat*0.78,20,95),clamp(fam.accentL+(isLight?-2:10),8,90)),"--ds-danger":hsl(rotate(h,-34),clamp(aSat*0.8,20,95),clamp(fam.accentL+(isLight?-1:10),8,90)),"--ds-info":hsl(rotate(h,18),clamp(aSat*0.72,20,95),clamp(fam.accentL+(isLight?-4:9),8,90)),"--ds-btn-primary-bg":hsl(h,aSat,fam.accentL),"--ds-btn-primary-bg-hover":hsl(h,aSat,clamp(fam.accentL+(isLight?-7:7),6,95)),"--ds-btn-primary-border":hsl(h,clamp(aSat*0.9,0,100),clamp(fam.accentL+(isLight?-13:2),6,95)),"--ds-btn-primary-text":isLight?"#ffffff":"#071018","--ds-bg-overlay":isLight?"rgba(24,26,30,0.15)":"rgba(5,9,15,0.72)","--ds-body-bg-image":"none","--ds-card-bg-image":"none"};if(familyKey==="cathode"||familyKey==="electric"){bundle["--ds-body-bg-image"]="radial-gradient(circle at 20% 8%, color-mix(in oklab, var(--ds-accent) 26%, transparent), transparent 45%), repeating-linear-gradient(0deg, rgba(255,255,255,0.012) 0px, rgba(255,255,255,0.012) 2px, transparent 2px, transparent 6px)";bundle["--ds-card-bg-image"]="linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.05))";}if(familyKey==="electric"){bundle["--ds-bg-overlay"]="rgba(2,7,14,0.8)";bundle["--ds-focus"]=hsl(h,100,82);}if(familyKey==="sunset"){bundle["--ds-bg-overlay"]="rgba(20,7,3,0.75)";}if(familyKey==="frost"){bundle["--ds-bg-overlay"]="rgba(24,38,58,0.18)";}if(familyKey==="paper"||familyKey==="pastel"||familyKey==="frost"){bundle["--ds-btn-primary-text"]="#ffffff";}if(familyKey==="monochrome"||familyKey==="noir"){bundle["--ds-success"]=bundle["--ds-accent"];bundle["--ds-warning"]=bundle["--ds-accent-strong"];bundle["--ds-danger"]=bundle["--ds-accent"];bundle["--ds-info"]=bundle["--ds-accent-strong"];}return bundle;}
const savedTheme=localStorage.getItem(storageKey); const initialTheme=savedTheme||root.getAttribute("data-theme")||"steel-night"; root.setAttribute("data-theme",initialTheme); themeSelect.value=initialTheme;
      function normalizeHex(v){const raw=(v||"").trim();if(!/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(raw))return null;if(raw.length===4)return "#"+raw[1]+raw[1]+raw[2]+raw[2]+raw[3]+raw[3];return raw.toLowerCase();}
      function toHex(v){const direct=normalizeHex(v);if(direct)return direct;const probe=document.createElement("span");probe.style.color="";probe.style.color=(v||"").trim();if(!probe.style.color)return null;probe.style.position="fixed";probe.style.left="-9999px";probe.style.top="-9999px";document.body.appendChild(probe);const resolved=getComputedStyle(probe).color;probe.remove();const m=resolved.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)/i);if(!m)return null;return "#"+[m[1],m[2],m[3]].map((n)=>Number(n).toString(16).padStart(2,"0")).join("");}
      function parseLength(v,f){const n=parseFloat(v);return Number.isFinite(n)?n:f;}
      function humanLabel(t){return t.replace("--ds-","").replace(/-/g," ");}
      function clearOverrides(){root.removeAttribute("style");}
      function setTokenBundle(b){Object.keys(b).forEach((t)=>root.style.setProperty(t,b[t]));}
      function setPresetSelectors(combo){if(!combo)return;familyPresetSelect.value=combo.family;huePresetSelect.value=combo.hue;stylePresetSelect.value=combo.style;scalePresetSelect.value=combo.scale;}
      function applySelectedPresetCombo(){root.removeAttribute("data-theme");setTokenBundle(buildColorBundle(familyPresetSelect.value,huePresetSelect.value));setTokenBundle(stylePresets[stylePresetSelect.value]);setTokenBundle(scalePresets[scalePresetSelect.value]);}
      function syncControlsFromComputed(){const cs=getComputedStyle(root);controlMap.forEach((meta,token)=>{const raw=cs.getPropertyValue(token).trim();if(meta.type==="color"){const hex=toHex(raw);if(hex){meta.main.value=hex;meta.extra.value=hex;}else{meta.extra.value=raw;}}else if(meta.type==="length")meta.main.value=parseLength(raw,0);else if(meta.type==="number")meta.main.value=parseFloat(raw)||0;else meta.main.value=raw;});}
      function applyControl(meta,source){let value="";if(meta.type==="color"){if(source==="picker"){value=normalizeHex(meta.main.value)||meta.main.value;meta.extra.value=value;}else{const normalized=toHex(meta.extra.value);if(!normalized)return;value=normalized;meta.main.value=normalized;meta.extra.value=normalized;}}else if(meta.type==="length")value=String(meta.main.value)+meta.unit;else value=meta.main.value;root.style.setProperty(meta.token,value);}
      function renderBuilder(){const host=document.getElementById("builderGroups");tokenGroups.forEach((group)=>{const card=document.createElement("article");card.className="ds-card builder-group";const title=document.createElement("h3");title.className="ds-card-title";title.textContent=group.name;card.appendChild(title);group.controls.forEach((control)=>{const field=document.createElement("div");field.className="builder-field";const label=document.createElement("label");label.textContent=humanLabel(control.token);field.appendChild(label);let main;let extra;if(control.type==="color"){const row=document.createElement("div");row.className="builder-field-row";main=document.createElement("input");main.type="color";main.className="builder-color";extra=document.createElement("input");extra.type="text";extra.className="ds-input";row.appendChild(main);row.appendChild(extra);field.appendChild(row);}else if(control.type==="select"){const row=document.createElement("div");row.className="builder-field-row single";main=document.createElement("select");main.className="ds-select";control.options.forEach((opt)=>{const option=document.createElement("option");option.value=opt;option.textContent=opt;main.appendChild(option);});row.appendChild(main);field.appendChild(row);}else{const row=document.createElement("div");row.className="builder-field-row single";main=document.createElement("input");main.className="ds-input";if(control.type==="length"||control.type==="number"){main.type="number";if(control.step)main.step=control.step;}else main.type="text";row.appendChild(main);field.appendChild(row);}const meta={token:control.token,type:control.type,unit:control.unit||"",main,extra};controlMap.set(control.token,meta);if(control.type==="color"){main.addEventListener("input",()=>applyControl(meta,"picker"));extra.addEventListener("input",()=>applyControl(meta,"text"));}else{main.addEventListener("input",()=>applyControl(meta));}card.appendChild(field);});host.appendChild(card);});}
      renderBuilder();
      const initialCombo=baseThemePresetMap[initialTheme];
      if(initialCombo){setPresetSelectors(initialCombo);clearOverrides();applySelectedPresetCombo();}
      syncControlsFromComputed();
      function sanitizeThemeName(raw){return (raw||"custom-theme").trim().replace(/[^a-z0-9\-_]/gi,"-").toLowerCase()||"custom-theme";}
      function buildThemeBlock(themeName){const lines=[":root[data-theme=\""+themeName+"\"] {"];controlMap.forEach((meta,token)=>{let value="";if(meta.type==="color")value=meta.extra.value.trim();else if(meta.type==="length")value=String(meta.main.value).trim()+meta.unit;else value=String(meta.main.value).trim();lines.push("  "+token+": "+value+";");});lines.push("}");return lines.join("\n");}
      function exportThemeBlock(){const name=sanitizeThemeName(document.getElementById("themeNameInput").value);const block=buildThemeBlock(name);document.getElementById("themeExportOutput").value=block;return { name, block };}
      function performReset(){clearOverrides();const combo=baseThemePresetMap[themeSelect.value];if(combo)setPresetSelectors(combo);applySelectedPresetCombo();syncControlsFromComputed();}
      function downloadBlob(filename,blob){const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=filename;document.body.appendChild(a);a.click();a.remove();setTimeout(()=>URL.revokeObjectURL(url),1500);}
      function crc32(bytes){let c=0^(-1);for(let i=0;i<bytes.length;i++){c=(c>>>8)^crcTable[(c^bytes[i])&255];}return (c^(-1))>>>0;}
      const crcTable=(()=>{const t=new Uint32Array(256);for(let n=0;n<256;n++){let c=n;for(let k=0;k<8;k++)c=((c&1)?(0xEDB88320^(c>>>1)):(c>>>1));t[n]=c>>>0;}return t;})();
      function makeZip(files){const enc=new TextEncoder();const localParts=[];const centralParts=[];let offset=0;const now=new Date();const dosTime=((now.getHours()&31)<<11)|((now.getMinutes()&63)<<5)|((Math.floor(now.getSeconds()/2))&31);const dosDate=(((now.getFullYear()-1980)&127)<<9)|(((now.getMonth()+1)&15)<<5)|(now.getDate()&31);files.forEach((f)=>{const nameBytes=enc.encode(f.name);const dataBytes=enc.encode(f.content);const crc=crc32(dataBytes);const lh=new Uint8Array(30);const lhv=new DataView(lh.buffer);lhv.setUint32(0,0x04034b50,true);lhv.setUint16(4,20,true);lhv.setUint16(6,0,true);lhv.setUint16(8,0,true);lhv.setUint16(10,dosTime,true);lhv.setUint16(12,dosDate,true);lhv.setUint32(14,crc,true);lhv.setUint32(18,dataBytes.length,true);lhv.setUint32(22,dataBytes.length,true);lhv.setUint16(26,nameBytes.length,true);lhv.setUint16(28,0,true);localParts.push(lh,nameBytes,dataBytes);const ch=new Uint8Array(46);const chv=new DataView(ch.buffer);chv.setUint32(0,0x02014b50,true);chv.setUint16(4,20,true);chv.setUint16(6,20,true);chv.setUint16(8,0,true);chv.setUint16(10,0,true);chv.setUint16(12,dosTime,true);chv.setUint16(14,dosDate,true);chv.setUint32(16,crc,true);chv.setUint32(20,dataBytes.length,true);chv.setUint32(24,dataBytes.length,true);chv.setUint16(28,nameBytes.length,true);chv.setUint16(30,0,true);chv.setUint16(32,0,true);chv.setUint16(34,0,true);chv.setUint16(36,0,true);chv.setUint32(38,0,true);chv.setUint32(42,offset,true);centralParts.push(ch,nameBytes);offset+=lh.length+nameBytes.length+dataBytes.length;});let centralSize=0;centralParts.forEach((p)=>{centralSize+=p.length;});const end=new Uint8Array(22);const ev=new DataView(end.buffer);ev.setUint32(0,0x06054b50,true);ev.setUint16(4,0,true);ev.setUint16(6,0,true);ev.setUint16(8,files.length,true);ev.setUint16(10,files.length,true);ev.setUint32(12,centralSize,true);ev.setUint32(16,offset,true);ev.setUint16(20,0,true);return new Blob([...localParts,...centralParts,end],{type:"application/zip"});}
      function buildPackageFiles(themeName,themeBlock){const recipe={themeName:themeName,baseTheme:themeSelect.value,colorFamily:familyPresetSelect.value,hue:huePresetSelect.value,style:stylePresetSelect.value,scale:scalePresetSelect.value,generatedAt:new Date().toISOString()};return[{name:"README.md",content:"# "+themeName+" theme package\n\nThis package was exported from Design System Studio.\nUse INSTALL.md for setup steps.\n"},{name:"INSTALL.md",content:"1. Copy `"+themeName+".css` into your project styles folder.\n2. Append the block into your theme file (or import it).\n3. Set `<html data-theme=\\\""+themeName+"\\\">` in your page.\n4. Ensure your app includes `_DesignSystem/theme.css` (or equivalent token+component files).\n"},{name:themeName+".css",content:themeBlock+"\n"},{name:"theme.recipe.json",content:JSON.stringify(recipe,null,2)}];}
      document.getElementById("applyPresetBtn").addEventListener("click",function(){clearOverrides();applySelectedPresetCombo();syncControlsFromComputed();});
      themeSelect.addEventListener("change",function(){const theme=themeSelect.value;root.setAttribute("data-theme",theme);localStorage.setItem(storageKey,theme);clearOverrides();const combo=baseThemePresetMap[theme];if(combo){setPresetSelectors(combo);applySelectedPresetCombo();}syncControlsFromComputed();});
      const resetDialog=document.getElementById("resetConfirmDialog"); const skipResetConfirmChk=document.getElementById("skipResetConfirmChk"); document.getElementById("resetOverridesBtn").addEventListener("click",function(){if(localStorage.getItem(resetConfirmKey)==="1"){performReset();return;}skipResetConfirmChk.checked=false;resetDialog.showModal();}); document.getElementById("cancelResetBtn").addEventListener("click",function(){resetDialog.close();}); document.getElementById("confirmResetBtn").addEventListener("click",function(){if(skipResetConfirmChk.checked)localStorage.setItem(resetConfirmKey,"1");resetDialog.close();performReset();});
      document.getElementById("exportThemeBtn").addEventListener("click",function(){exportThemeBlock();});
      document.getElementById("copyExportBtn").addEventListener("click",async function(){const out=document.getElementById("themeExportOutput");if(!out.value.trim())exportThemeBlock();if(!out.value.trim())return;try{await navigator.clipboard.writeText(out.value);}catch(_){out.select();document.execCommand("copy");}});
      document.getElementById("downloadPackageBtn").addEventListener("click",function(){const exp=exportThemeBlock();const files=buildPackageFiles(exp.name,exp.block);const zip=makeZip(files);downloadBlob(exp.name+"-theme-package.zip",zip);});
      document.querySelectorAll(".studio-tab").forEach((btn)=>btn.addEventListener("click",function(){const panel=btn.getAttribute("data-panel");document.querySelectorAll(".studio-tab").forEach((b)=>b.setAttribute("aria-selected","false"));document.querySelectorAll(".studio-panel").forEach((p)=>p.hidden=true);btn.setAttribute("aria-selected","true");document.getElementById("panel-"+panel).hidden=false;}));
      const dropdown=document.getElementById("actionsDropdown"); const dropdownToggle=document.getElementById("dropdownToggle"); dropdownToggle.addEventListener("click",function(){const open=dropdown.classList.toggle("is-open");dropdownToggle.setAttribute("aria-expanded",String(open));});
      const popover=document.getElementById("helpPopover"); document.getElementById("popoverToggle").addEventListener("click",function(){popover.classList.toggle("is-open");});
      document.addEventListener("click",function(event){if(!dropdown.contains(event.target)){dropdown.classList.remove("is-open");dropdownToggle.setAttribute("aria-expanded","false");}if(!popover.contains(event.target))popover.classList.remove("is-open");});
      const modal=document.getElementById("modal"); const drawer=document.getElementById("drawer"); document.getElementById("openModalBtn").addEventListener("click",function(){modal.showModal();}); document.getElementById("closeModalBtn").addEventListener("click",function(){modal.close();}); document.getElementById("openDrawerBtn").addEventListener("click",function(){drawer.showModal();}); document.getElementById("closeDrawerBtn").addEventListener("click",function(){drawer.close();});
      function addToast(kind,text){const stack=document.getElementById("toastStack");const node=document.createElement("div");node.className="ds-toast "+kind;node.textContent=text;stack.appendChild(node);setTimeout(function(){node.remove();},2600);} document.getElementById("toastSuccessBtn").addEventListener("click",function(){addToast("success","Saved successfully.");}); document.getElementById("toastErrorBtn").addEventListener("click",function(){addToast("danger","Action failed. Please retry.");});
      const sliderDemo=document.getElementById("sliderDemo"); const sliderDemoValue=document.getElementById("sliderDemoValue"); sliderDemo.addEventListener("input",function(){sliderDemoValue.textContent=sliderDemo.value;});
      const segDemo=document.getElementById("segDemo"); segDemo.querySelectorAll("button").forEach((b)=>b.addEventListener("click",function(){segDemo.querySelectorAll("button").forEach((x)=>x.setAttribute("aria-pressed","false"));b.setAttribute("aria-pressed","true");}));
      let arrowValue=0; const arrowOut=document.getElementById("arrowValue"); document.getElementById("arrowUpBtn").addEventListener("click",function(){arrowValue+=1;arrowOut.textContent=String(arrowValue);}); document.getElementById("arrowDownBtn").addEventListener("click",function(){arrowValue-=1;arrowOut.textContent=String(arrowValue);});
    })();
  </script>
</body>
</html>


